#!/bin/sh

_update_sock2path() {
    local s2pa_fil s2pa_dir s2pa_tmp found files f
    echo ">>> Updating etc/sock2path..." >&2
    s2pa_fil=etc/sock2path
    s2pa_dir=etc/sock2path.d
    s2pa_tmp=var/tmp/sock2path.tmp.$$
    found=no
    files="$s2pa_dir/*"
    (   echo '# Generated from sock2path.d by openss7'
	echo '# DO NOT EDIT THIS FILE: ALL EDITS WILL BE LOST!'
	echo '# EDIT THE FILES IN THE sock2path.d DIRECTORY INSTEAD.'
    ) >$s2pa_tmp
    for f in $files; do
	if [ -f $f ]; then
	    case $f in
		(*.pacorig|*.pacnew) ;;
		(*) (   echo '# Generated from sock2path.d/'`basename $f`
			sed '/^[[:space:]]*##/d;/^[[:space:]]*$/d' $f
		    ) >>$s2pa_tmp
		    found=yes ;;
	    esac
	fi
    done
    if [ $found = no ]; then
	rm -f -- $s2pa_fil
	rmdir $s2pa_dir 2>/dev/null || :
    else
	if ! diff $s2pa_tmp $s2pa_fil >/dev/null 2>&1; then
	    cp -f -b --suffix=.pacorig -- $s2pa_tmp $s2pa_fil
	fi
    fi
    rm -f -- $s2pa_tmp || :
}

_update_sock2path || :

# vim: sw=4
