#!/bin/sh
#
# Argument to this script can be:
#
# <empty>	Do a default make in strinet
# clean		Do a make clean in strinet
# realclean	Remove the subdirectory, leave the archive
#
#ident "@(#) LiS make_strinet 1.4 6/4/03"

if [ ! -f /usr/src/LiS/config.in ]; then
    echo "/usr/src/LiS/config.in missing.  Cannot make strinet"
    exit 0
fi

. /usr/src/LiS/config.in

if [ "$KVER_MAJORMINOR..." = "2.2..." ]; then
    echo "Cannot make strinet for a 2.2 kernel"
    exit 0
fi

archive=`ls *.tgz`
dir=`echo $archive | sed -e 's/\.tgz//'`

if [ "$1..." = "realclean..." ]; then
    if [ -d $dir ]; then
	rm -rf $dir 2>/dev/null
	exit 0
    fi
fi

if [ ! -f /usr/lib/libLiS.so -o ! -f /usr/lib/libLiS.a ]; then
    echo "Cannot do make in strinet until after make install in LiS"
    exit 0
fi

if [ ! -d $dir ]; then
    tar xzf $archive
fi

if [ ! -d $dir ]; then
    echo "No directory `pwd`/$dir"
    exit 1
fi

cd $dir
make $1
