\input texinfo
@c -*- texinfo -*- vim: ft=texinfo
@c vim: ft=texinfo nosmartindent nocindent noautoindent tw=100
@c =========================================================================
@c
@c @(#) doc/manual/porting.texi
@c
@c =========================================================================
@c
@c Copyright (c) 2008-2015  Monavacon Limited <http://www.monavacon.com/>
@c Copyright (c) 2001-2008  OpenSS7 Corporation <http://www.openss7.com/>
@c Copyright (c) 1997-2001  Brian F. G. Bidulock <bidulock@openss7.org>
@c
@c All Rights Reserved.
@c
@c Permission is granted to copy, distribute and/or modify this document
@c under the terms of the GNU Free Documentation License, Version 1.3 or
@c any later version published by the Free Software Foundation; with no
@c Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.  A
@c copy of the license is included in the section entitled "GNU Free
@c Documentation License".
@c
@c Permission to use, copy and distribute this documentation without
@c modification, for any purpose and without fee or royalty is hereby
@c granted, provided that both the above copyright notice and this
@c permission notice appears in all copies and that the name of OpenSS7
@c Corporation not be used in advertising or publicity pertaining to
@c distribution of this documentation or its contents without specific,
@c written prior permission.  OpenSS7 Corporation makes no representation
@c about the suitability of this documentation for any purpose.  It is
@c provided "as is" without express or implied warranty.
@c 
@c Permission is granted to process this file through Tex and print the
@c results, provided the printed document carries copying permission
@c notice identical to this one except for the removal of this paragraph
@c (this paragraph not being relevant to the printed manual).
@c 
@c OPENSS7 CORPORATION DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS
@c DOCUMENTATION INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY,
@c FITNESS FOR A PARTICULAR PURPOSE, NON-INFRINGEMENT, OR TITLE; THAT THE
@c CONTENTS OF THE DOCUMENT ARE SUITABLE FOR ANY PURPOSE, OR THAT THE
@c IMPLEMENTATION OF SUCH CONTENTS WILL NOT INFRINGE ON ANY THIRD PARTY
@c PATENTS, COPYRIGHTS, TRADEMARKS OR OTHER RIGHTS.  IN NO EVENT SHALL
@c OPENSS7 CORPORATION BE LIABLE FOR ANY DIRECT, INDIRECT, SPECIAL OR
@c CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF
@c USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
@c OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH ANY USE OF
@c THIS DOCUMENT OR THE PERFORMANCE OR IMPLEMENTATION OF THE CONTENTS
@c THEREOF.
@c 
@c Since the Linux kernel and libraries are constantly changing, this
@c manual page may be incorrect or out-of-date.  The author(s) assume no
@c responsibility for errors or omissions, or for damages resulting from
@c the use of the information contained herein.  The author(s) may not
@c have taken the same level of care in the production of this manual,
@c which is licensed free of charge, as they might when working
@c professionally.
@c 
@c Formatted or processed versions of this manual, if unaccompanied by
@c the source, must acknowledge the copyright and authors of this work.
@c
@c -------------------------------------------------------------------------
@c
@c U.S. GOVERNMENT RESTRICTED RIGHTS.  If you are licensing this Software
@c on behalf of the U.S. Government ("Government"), the following
@c provisions apply to you.  If the Software is supplied by the Department
@c of Defense ("DoD"), it is classified as "Commercial Computer Software"
@c under paragraph 252.227-7014 of the DoD Supplement to the Federal
@c Acquisition Regulations ("DFARS") (or any successor regulations) and the
@c Government is acquiring only the license rights granted herein (the
@c license rights customarily provided to non-Government users).  If the
@c Software is supplied to any unit or agency of the Government other than
@c DoD, it is classified as "Restricted Computer Software" and the
@c Government's rights in the Software are defined in paragraph 52.227-19
@c of the Federal Acquisition Regulations ("FAR") (or any successor
@c regulations) or, in the cases of NASA, in paragraph 18.52.227-86 of the
@c NASA Supplement to the FAR (or any successor regulations).
@c
@c =========================================================================
@c 
@c Commercial licensing and support of this software is available from
@c OpenSS7 Corporation at a fee.  See http://www.openss7.com/
@c 
@c =========================================================================
@c

@setfilename porting.info
@include ../../scripts/texi/args.texi
@set MANUAL_TITLE Linux Fast-STREAMS
@set MANUAL_TYPE Porting Guide
@settitle @value{MANUAL_TITLE}

@dircategory STREAMS
@direntry
* Porting: (porting).			STREAMS Porting Guide
@end direntry

@include ../../scripts/texi/args.texi
@set MANUAL_TITLE Linux Fast-STREAMS
@set MANUAL_TYPE Porting Guide

@comment The following copyright information goes at the head of each .info file.
@ifinfo
This file provides the @value{MANUAL_TYPE} for @value{MANUAL_TITLE}.

This is Edition @value{PACKAGE_RELEASE}@value{PACKAGE_PATCHLEVEL}, last updated @value{PACKAGE_DATE}, of the
@cite{@value{MANUAL_TITLE} @value{MANUAL_TYPE}}, for Version @value{PACKAGE_VERSION}
Release @value{PACKAGE_RELEASE}@value{PACKAGE_PATCHLEVEL}.

Copyright @copyright{} 2008-2015  @uref{http://www.monavacon.com/, Monavacon Limited} @*
Copyright @copyright{} 2001-2008  @uref{http://www.openss7.com/, OpenSS7 Corporation} @*
Copyright @copyright{} 1997-2001  @email{bidulock@@openss7.org, Brian F. G. Bidulock} @*

All Rights Reserved.

Permission is granted to copy, distribute and/or modify this document under the terms of the GNU
Free Documentation License, Version 1.3 or any later version published by the Free Software
Foundation; with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.  A copy of
the license is included in the section entitled @ref{GNU Free Documentation License}.

Permission to use, copy and distribute this documentation without modification, for any purpose and
without fee or royalty is hereby granted, provided that both the above copyright notice and this
permission notice appears in all copies and that the name of @cite{OpenSS7 Corporation} not be used in
advertising or publicity pertaining to distribution of this documentation or its contents without
specific, written prior permission.  @cite{OpenSS7 Corporation} makes no representation about the
suitability of this documentation for any purpose.  It is provided ``as is'' without express or
implied warranty.

@ignore
Permission is granted to process this file through Tex and print the results, provided the printed
document carries copying permission notice identical to this one except for the removal of this
paragraph (this paragraph not being relevant to the printed manual).

@end ignore
OPENSS7 CORPORATION DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, NON-INFRINGEMENT, OR TITLE; THAT
THE CONTENTS OF THE DOCUMENT ARE SUITABLE FOR ANY PURPOSE, OR THAT THE IMPLEMENTATION OF SUCH
CONTENTS WILL NOT INFRINGE ON ANY THIRD PARTY PATENTS, COPYRIGHTS, TRADEMARKS OR OTHER RIGHTS.  IN
NO EVENT SHALL OPENSS7 CORPORATION BE LIABLE FOR ANY DIRECT, INDIRECT, SPECIAL OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION
OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH ANY USE OF
THIS DOCUMENT OR THE PERFORMANCE OR IMPLEMENTATION OF THE CONTENTS THEREOF.
@end ifinfo

@include ../../scripts/texi/args.texi
@set MANUAL_TITLE Linux Fast-STREAMS
@set MANUAL_TYPE Porting Guide

@shorttitlepage @value{MANUAL_TITLE} @value{MANUAL_TYPE}
@titlepage
@titlefont{@value{MANUAL_TITLE}}
@sp 1
@title @value{MANUAL_TYPE}
@subtitle Version @value{PACKAGE_VERSION} Edition @value{PACKAGE_RELEASE}@value{PACKAGE_PATCHLEVEL}
@subtitle Updated @value{PACKAGE_PDATE}
@subtitle Distributed with Package @value{PACKAGE}-@value{VERSION}
@sp 2
@subtitle Copyright @copyright{} 2008-2015  Monavacon Limited
@subtitle All Rights Reserved.
@sp 4
@quotation
@chapheading Abstract:
This document is a @value{MANUAL_TYPE} containing technical details concerning the implementation of
the @value{MANUAL_TITLE} for OpenSS7.  It contains recommendations on software architecture as well
as platform and system applicability of the @value{MANUAL_TITLE}.
@end quotation
@author Brian Bidulock <@email{bidulock@@openss7.org}> for
@author The OpenSS7 Project <@uref{http://www.openss7.org/}>

@page
@vskip 0pt plus 1filll

@chapheading Published by:

@sp 1

@noindent
@uref{http://www.openss7.com/,OpenSS7 Corporation} @*
1469 Jefferys Crescent @*
Edmonton, Alberta  T6L 6T1 @*
Canada @*

@noindent
Copyright @copyright{} 2008-2015  @uref{http://www.monavacon.com/, Monavacon Limited} @*
Copyright @copyright{} 2001-2008  @uref{http://www.openss7.com/, OpenSS7 Corporation} @*
Copyright @copyright{} 1997-2000  @email{bidulock@@openss7.org, Brian F. G. Bidulock} @*

@noindent
All Rights Reserved.

@sp 1

@noindent
Unauthorized distribution or duplication is prohibited.

@sp 1

@noindent
Permission is granted to copy, distribute and/or modify this document under the terms of the GNU
Free Documentation License, Version 1.3 or any later version published by the Free Software
Foundation; with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.  A copy of
the license is included in the section entitled @ref{GNU Free Documentation License}.

@noindent
Permission to use, copy and distribute this documentation without modification, for any purpose and
without fee or royalty is hereby granted, provided that both the above copyright notice and this
permission notice appears in all copies and that the name of @cite{OpenSS7 Corporation} not be used in
advertising or publicity pertaining to distribution of this documentation or its contents without
specific, written prior permission.  @cite{OpenSS7 Corporation} makes no representation about the
suitability of this documentation for any purpose.  It is provided ``as is'' without express or
implied warranty.

@chapheading Notice:

@noindent
@strong{OpenSS7 Corporation disclaims all warranties with regard to this documentation including all
implied warranties of merchantability, fitness for a particular purpose, non-infringement, or title;
that the contents of the document are suitable for any purpose, or that the implementation of such
contents will not infringe on any third party patents, copyrights, trademarks or other rights.  In
no event shall OpenSS7 Corporation be liable for any direct, indirect, special or consequential
damages or any damages whatsoever resulting from loss of use, data or profits, whether in an action
of contract, negligence or other tortious action, arising out of or in connection with any use of
this document or the performance or implementation of the contents thereof.}

@vskip 0pt
@end titlepage
@iftex
@headings off
@everyheading @thistitle @| @thisfile @| @thischaptername
@evenheading @thischapter @| @| @thisfile
@oddheading @thistitle @| @| @thischaptername
@everyfooting Version @value{PACKAGE_VERSION} Rel. @value{PACKAGE_RELEASE}@value{PACKAGE_PATCHLEVEL} @| @value{PACKAGE_DATE} @| @thispage
@evenfooting @thispage @| @| Version @value{PACKAGE_VERSION} Rel. @value{PACKAGE_RELEASE}@value{PACKAGE_PATCHLEVEL}
@oddfooting @value{PACKAGE_DATE} @| @| @thispage
@end iftex

@c Define an index of primitives
@defcodeindex pr
@c Define an index of primitive values
@defcodeindex pv
@c Define an index of primitive error values
@defcodeindex pe
@c Define an index of protocol states
@defcodeindex st
@c Define an index of input-output controls
@defcodeindex ct
@c Define an index of manual pages.
@defcodeindex mp
@c Define an index of MIB objects.
@defcodeindex mo

@c frags out automake
@c @ifnottex
@c @c concatenate indices for text, html and info
@syncodeindex pr cp
@syncodeindex pv cp
@syncodeindex pe cp
@syncodeindex st cp
@syncodeindex mp cp
@c @syncodeindex tp cp
@c @syncodeindex vr cp
@syncodeindex ct cp
@syncodeindex mo cp
@c @end ifnottex

@include texi/macros.texi
@include texi/versions.texi
@include texi/prims.texi

@shortcontents
@contents

@ifnottex
@node Top
@top @value{MANUAL_TITLE} @value{MANUAL_TYPE}
@heading About This Manual
This is Edition @value{PACKAGE_RELEASE}@value{PACKAGE_PATCHLEVEL}, last updated @value{PACKAGE_DATE}, of
@cite{The @value{MANUAL_TITLE} @value{MANUAL_TYPE}}, for Version
@value{PACKAGE_VERSION} release @value{PACKAGE_RELEASE}@value{PACKAGE_PATCHLEVEL} of the
@value{PACKAGE_TITLE} package.
@end ifnottex

@menu
* Preface::
* Porting::
* Development::
* Licenses::
* Indices::
@end menu

@c --------------------------------------------------------------------------

@node Preface
@unnumbered Preface

@menu
* Acknowledgements::
@end menu

@node Acknowledgements
@section Acknowledgements
@cindex credits

@include texi/funding.texi

@node Porting
@chapter Porting
@cindex porting

Although each of the manual pages of supported functions and structures
provides compatibility and porting information, this document attempts to
gather together pertinent information concerning porting from various UNIX
operating system supporting STREAMS.

The porting information is organized by the operating system from which
porting is being attempted.  Note that, aside from configuration details, any
system not listed here that is based on SVR 4.2 MP or on a another of the
implementations, should start with that implementation's portability
information.

Porting information is organized into sections as follows:

@menu
* Porting from SVR 3.2::
* Porting from SVR 4.2 MP::
* Porting from AIX 5L Version 5.1::
* Porting from HP-UX 11.0i v2::
* Porting from OSF/1 1.2/Digital UNIX::
* Porting from UnixWare 7.1.3 (OpenUnix 8)::
* Porting from Solaris 9/SunOS 5.9::
* Porting from SUPER-UX::
* Porting from UXP/V::
* Porting from Mac Open Transport::
* Porting from Mentat Portable STREAMS::
@end menu

@section Base Functions
@cindex Base Functions

@cite{@value{PACKAGE_TITLE}} provides a complete set of base functions and utilities for
@acronym{STREAMS} as defined in the @cite{SVR 4 Programmer's Guide -- STREAMS}.  These are the base set
of functions with which the @acronym{STREAMS} module and driver writer is familiar.

@subsection Message Functions
@cindex message functions

@cite{@value{PACKAGE_TITLE}} performs stricter message block, data block and
buffer alignment than most @acronym{STREAMS} implementations to maintain maximum
compatibility with other implementations.  Message blocks, data blocks and data
buffers are always aligned at least to an SMP cache boundary, permitting DMA of
message blocks, data blocks and data buffers.  ISA DMA capability is not ensured
for message blocks or data blocks, however, external data buffers can be so
allocated with @cite{Linux} allocators and attached to a message and data buffer
with @manref{@b{esballoc}(9)}.

Data buffers of size less than the value @var{FASTBUF} are allocated of size
@var{FASTBUF} and are internal to the data block.  A @var{FASTBUF} is at least
64-bytes on 32-bit architectures and at least 128-bytes on 64-bit architectures.
Internal data buffers of size @var{FASTBUF} are aligned to a 64-byte boundary on
32-bit architecture and to a 128-byte boundary on 64-bit architectures.

Data buffers of larger than a @var{FASTBUF} are allocated using general purpose
@cite{Linux} allocators (i.e. @manref{@b{kmem_alloc}(9)}).  @cite{Linux} always
allocates a memory extent of a power of two in size that fits the requested
number of bytes and always aligns the memory extent to the memory boundary that
is the same power of two as the resulting size.  This is stricter in alignment
than the description of most @cite{UNIX} memory allocators.

@cite{@value{PACKAGE_TITLE}} also supports the @var{BPRI_WAITOK} priority to
@manpage{@b{allocb}(9)} that will allocate memory block, data block and data
buffer using @var{KM_SLEEP} and will block the calling process if either memory
block, data block or data buffer are not immediately available.

@subsubsection Compatibilty Functions

Following are the basic @acronym{STREAMS} message functions.  Most portability
issues concerning @acronym{STREAMS} message functions have to do with allocation,
alignment of the data buffer, priority of allocation, disposition of unused
message blocks, handling of @var{NULL} pointer arguments, buffer callback and
message free routine handling.

@table @asis

@item @manref{@b{adjmsg}(9)}
Trim bytes from the front or back of a @acronym{STREAMS} message.  Trimmed message blocks are not freed
but simply have their @var{b_wptr} set to their @var{b_rptr}.

@item @manref{@b{allocb}(9)}
Allocate a @acronym{STREAMS} message and data block.  This function also accepts the @var{BPRI_WAITOK}
flag which allocates all parts of the message 3-tuple using @var{KM_SLEEP} allocation.  Allocation
of less than @var{FASTBUF} bytes will allocate a data buffer of size @var{FASTBUF}.  @var{FASTBUF}
sized data buffers are internal to the data block, and message block, data block and data buffer
3-types are allocated as a unit for speed.  Data buffers are allocated on a memory boundary that is
the same as the next power of two sized buffer.

@item @manref{@b{bufcall}(9)}
Install a buffer callback.  @cite{@value{PACKAGE_TITLE}} provides the additional assurance that the
callback routine will not be called until the caller returns from the calling function block.

@item @manref{@b{copyb}(9)}
Copy a @acronym{STREAMS} message block.  A @var{NULL} pointer passed as an argument will panic the
kernel.

@item @manref{@b{copymsg}(9)}
Copy a @acronym{STREAMS} message.  Performs a block-wise copy using @manpage{@b{copyb}(9)}.

@item @manref{@b{datamsg}(9)}
Tests a @acronym{STREAMS} message type for data.

@item @manref{@b{dupb}(9)}
Duplicate a @acronym{STREAMS} message block.  @cite{@value{PACKAGE_TITLE}} uses a global lock to
protect the @var{db_refs} member of the data block.

@item @manref{@b{dupmsg}(9)}
Duplicate a @acronym{STREAMS} message.  Performs a block-wise duplication using @manpage{@b{dupb}(9)}.

@item @manref{@b{esballoc}(9)}
Allocate a @acronym{STREAMS} message and data block with a caller supplied data buffer.  This is the
most portable method of allocating a data buffer that requires some particular alignment.  The
callback free routine is inherently unsafe when the function is provided by a module and modules are
permitted to unload.

@item @manref{@b{freeb}(9)}
Frees a @acronym{STREAMS} message block.

@item @manref{@b{freemsg}(9)}
Frees a @acronym{STREAMS} message.  Performs a block-wise free using @manpage{@b{freeb}(9)}.

@item @manref{@b{linkb}(9)}
Link a message block to a @acronym{STREAMS} message.  Panics if either argument is @var{NULL}.

@item @manref{@b{msgdsize}(9)}
Calculate the size of the data in a @acronym{STREAMS} message.  Accepts a @var{NULL} pointer, in which
case the function returns zero (@samp{0}).

@item @manref{@b{msgpullup}(9)}
Pull up bytes in a @acronym{STREAMS} message.  Might allocate a new message to satisfy the request.

@item @manref{@b{pcmsg}(9)}
Test a data block message type for priority control.

@item @manref{@b{pullupmsg}(9)}
Pull up the bytes in a @acronym{STREAMS} message.  Does not allocate a new initial message block, but
may allocate a new initial data block and data buffer.  The pointers @samp{mp->b_wptr} and
@samp{mp->b_rptr} are potentially invalidated by the call.

@item @manref{@b{rmvb}(9)}
Remove a message block from a @acronym{STREAMS} message.  The message block must exist in the message.
Passing @var{NULL} pointers will panic the kernel.

@item @manref{@b{testb}(9)}
Test if a @acronym{STREAMS} message can be allocated.  Because the test is not atomic, when this
function returns true, a subsequent call to @manpage{@b{allocb}(9)} could still fail.

@item @manref{@b{unbufcall}(9)}
Remove a @acronym{STREAMS} buffer callback.  @cite{@value{PACKAGE_TITLE}} provides the @cite{SVR 4}
assurance that before the call returns the callback function will either have been cancelled or
execution of the callback will be complete.

@item @manref{@b{unlinkb}(9)}
Unlink a message block from a @acronym{STREAMS} message.

@end table

@subsection UP Queue Functions
@cindex UP queue functions

Single processor queue functions are those functions that existed in @cite{SVR
4} before multi-processor support was added in @cite{SVR 4.1 MP} and @cite{SVR
4.2}.  Most portability issues associated with these functions concern queue
@var{q_next} pointer dereferencing and freezing of Streams when directly
manipulating queues.  @cite{@value{PACKAGE_TITLE}} provides the added assurance
that @var{q_next} pointers can always be reliably dereferenced from within a
queue put, service, open, close or synchronized callback procedure.

@table @asis

@item @manref{@b{backq}(9)}
Find the upstream or downstream queue.  @cite{@value{PACKAGE_TITLE}} protects
this pointer dereference when called from within a put, service, open, close or
callback procedure.

@item @manref{@b{bcanput}(9)}
Test flow control on a @acronym{STREAMS} message queue.
@cite{@value{PACKAGE_TITLE}} follows @cite{SVR 4} semantics for queue enabling,
queue flags and back-enabling.

@item @manref{@b{canenable}(9)}
Test whether a @acronym{STREAMS} message queue can be scheduled.  This only effects
normal priority messages as per @cite{SVR 4} semantics.

@item @manref{@b{enableok}(9)}
Allow a @acronym{STREAMS} message queue to be scheduled.  This only effects normal
priority messages as per @cite{SVR 4} semantics.

@item @manref{@b{flushband}(9)}
Flushes band @acronym{STREAMS} messages from a message queue.
@cite{@value{PACKAGE_TITLE}} provides a mechanism that efficiently flushes large
numbers of messages from a queue: messages are unlinked from the queue and freed
later by the @acronym{STREAMS} scheduler.

@item @manref{@b{flushq}(9)}
Flushes messages from a @acronym{STREAMS} message queue.
@cite{@value{PACKAGE_TITLE}} provides a mechanism that efficiently flushes large
numbers of messages from a queue: messages are unlinked from the queue and freed
later by the @acronym{STREAMS} scheduler.

@item @manref{@b{getq}(9)}
Gets a message from a @acronym{STREAMS} message queue.
@cite{@value{PACKAGE_TITLE}} follows @cite{SVR 4} semantics for queue enabling,
queue flags and back-enabling.

@item @manref{@b{insq}(9)}
Inserts a message into a @acronym{STREAMS} message queue.
@cite{@value{PACKAGE_TITLE}} recommends, but does not require, that the Stream
be first frozen by the caller with a call to
@manpage{@b{freezestr}(9)}.@footnote{It is possible that the @acronym{STREAMS}
module or driver writer can make such assurances with mechanisms other than
@manpage{@b{freezestr}(9)}.  See the @manref{@b{freezestr}(9)} manual page for
more information.}

@item @manref{@b{noenable}(9)}
Disable a @acronym{STREAMS} message queue from being scheduled.  This only effects
normal priority messages as per @cite{SVR 4} semantics.

@item @manref{@b{OTHERQ}(9)}
Return the other queue of a @acronym{STREAMS} queue pair.

@item @manref{@b{putbq}(9)}
Put a message back on a @acronym{STREAMS} message queue.
@cite{@value{PACKAGE_TITLE}} follows @cite{SVR 4} semantics for queue enabling,
queue flags and back-enabling.

@item @manref{@b{putctl}(9)}
Put a control message on a @acronym{STREAMS} message queue.

@item @manref{@b{putctl1}(9)}
Put a 1 byte control message on a @acronym{STREAMS} message queue.

@item @manref{@b{putq}(9)}
Put a message on a @acronym{STREAMS} message queue.  @cite{@value{PACKAGE_TITLE}}
follows @cite{SVR 4} semantics for queue enabling, queue flags and back-enabling.

@item @manref{@b{qenable}(9)}
Schedules a @acronym{STREAMS} message queue service routine.

@item @manref{@b{qreply}(9)}
Replies to a message from a @acronym{STREAMS} message queue.

@item @manref{@b{qsize}(9)}
Return the number of messages on a queue.

@item @manref{@b{RD}(9)}
Return the read queue of a @acronym{STREAMS} queue pair.  Although
@cite{@value{PACKAGE_TITLE}} accepts a read queue pointer as an argument, doing
so could panic some implementations.  The macro @manpage{@b{_RD}(9)} is also
provided that has this stricter behaviour.

@item @manref{@b{rmvq}(9)}
Remove a message from a @acronym{STREAMS} message queue.
@cite{@value{PACKAGE_TITLE}} recommends, but does not require, that the Stream
be first frozen by the caller with a call to
@manpage{@b{freezestr}(9)}.@footnote{It is possible that the @acronym{STREAMS}
module or driver writer can make such assurances with mechanisms other than
@manpage{@b{freezestr}(9)}.  See the @manref{@b{freezestr}(9)} manual page for
more information.}

@item @manref{@b{SAMESTR}(9)}
Test for @acronym{STREAMS} pipe or fifo.

@item @manref{@b{WR}(9)}
Return the write queue of a @acronym{STREAMS} queue pair.  Although
@cite{@value{PACKAGE_TITLE}} accepts a write queue pointer as an argument, doing
so could panic some implementations.  The macro @manpage{@b{_WR}(9)} is also
provided that has this stricter behaviour.

@end table

@subsection MP Queue Functions
@cindex MP queue functions

When multiprocessing support was added to @acronym{STREAMS} in @cite{SVR 4.1 MP} and
@cite{SVR 4.2}, it became necessary to enhance the @acronym{STREAMS} interface with
a number of additional functions intended on easing multiprocessor
implementation of @acronym{STREAMS}.  Most portability issues with functions in this
category involve queue pointer dereferencing, and queue manipulation.

@cite{@value{PACKAGE_TITLE}} provides stronger assurances for @var{q_next}
pointer dereferencing that are experienced on most other @acronym{STREAMS}
implementations, to maintain maximum compatibility.
@cite{@value{PACKAGE_TITLE}} acquires a Stream head plumbing read lock before
entering queue put, service, open, close and queue synchronous callback
procedures within the Stream.  This means that a function call such as
@samp{canput(q->q_next)} and @samp{canputnext(q)} have identical effect within
the synchronous procedure.

@table @asis

@item @manref{@b{bcanputnext}(9)}
Test flow control on a message queue.
@cite{@value{PACKAGE_TITLE}} ensures the validity of @var{q_next} pointer
dereferencing for any queue in the queue pair for which a queue put, service,
open, close or synchronized callback procedure is the context of the
dereference.  For other @var{q_next} dereferences (e.g. at a Stream end or
across a multiplexing driver), the @manpage{@b{bcanputnext}(9)} utility should
be used instead of the @manpage{@b{bcanput}(9)} utility.  @samp{bcanputnext(q,
band)} should always be preferred over @samp{bcanput(q->q_next, band)}.

@item @manref{@b{canputnext}(9)}
Test flow control on a message queue.
@cite{@value{PACKAGE_TITLE}} ensures the validity of @var{q_next} pointer
dereferencing for any queue in the queue pair for which a queue put, service,
open, close or synchronized callback procedure is the context of the
dereference.  For other @var{q_next} dereferences (e.g. at a Stream end or
across a multiplexing driver), the @manpage{@b{canputnext}(9)} utility should be
used instead of the @manpage{@b{canput}(9)} utility.  @samp{canputnext(q)}
should always be preferred over @samp{canput(q->q_next)}.

@item @manref{@b{freezestr}(9)}
Freeze the state of a stream queue.
@manpage{@b{freezestr}(9)} was provided in the MP environment to behave in the
same fashion as @manpage{@b{spl}(9)} did in the UP environment.  In the UP
environment it was a simply matter to suppress interrupts before directly
manipulating queue structures and then re-enable interrupts after queue
manipulation was complete.

@item @manref{@b{put}(9)}
Invoke the put procedure for a @acronym{STREAMS} module or driver with a @acronym{STREAMS} message.
In the UP environment, the queue at a Stream end could be called directly such
as @samp{(*q->q_qinfo->qi_putp)(q, mp)}.  In the MP environment, this would
circumvent the @acronym{STREAMS} synchronization model and the @manpage{@b{put}(9)}
utility function should be used instead.

@item @manref{@b{putnext}(9)}
Put a message on the downstream @acronym{STREAMS} message queue.
In the UP environment, the adjacent queue put procedure could be called directly
such as @samp{(*q->q_next->q_qinfo->qi_putp)(q, mp)}.  In the MP environment,
this would circumvent the @acronym{STREAMS} synchronization model and the
@manpage{@b{putnext}(9)} utility function should be used instead.
@samp{putnext(q, mp)} should always be used in preference to
@samp{put(q->q_next, mp)}.

@item @manref{@b{putnextctl1}(9)}
Put a 1 byte control message on the downstream @acronym{STREAMS} message queue.
A @var{q_next} pointer dereferencing version of @manpage{@b{putctl1}(9)}.
@samp{putnextctl1(q, type, param)} should always be used in preference to
@samp{putctl1(q->q_next, type, param)}.

@item @manref{@b{putnextctl}(9)}
Put a control message on the downstream @acronym{STREAMS} message queue.
A @var{q_next} pointer dereferencing version of @manpage{@b{putctl}(9)}.
@samp{putnextctl(q, type)} should always be used in preference to
@samp{putctl(q->q_next, type)}.

@item @manref{@b{qprocsoff}(9)}
Disables @acronym{STREAMS} message queue processing for multi-processing.

@item @manref{@b{qprocson}(9)}
Enables @acronym{STREAMS} message queue processing for multi-processing.
In the UP environment, it was possible to prepare the queue service and put
procedures for proper operation before returning and permitting the queue to run
put or service procedures.  In the MP environment, it became necessary to
indicate within the open procedure when queue procedures are to be permitted to
run before returning (or blocking).  @manpage{@b{qprocson}(9)} was added to
accomplish this.  @cite{SVR 4} says that this function must be cause before
returning from the queue open routine.  @cite{@value{PACKAGE_TITLE}} will invoke
the function implicitly if it is not called before the queue open routine
returns (but must still be called explicitly if the queue open routine blocks
awaiting an event on the queue).

@item @manref{@b{strqget}(9)}
Gets information about a @acronym{STREAMS} message queue.
In the UP environment, it was possible to directly manipulate streamtab or queue
structures after suppressing interrupts.  The @manpage{@b{strqget}(9)} utility
provides a mechanism for manipulating these structures in the MP environment.
Some implementations conflict on whether a Stream must first be frozen with
@manpage{@b{freezestr}(9)} or not.  @cite{@value{PACKAGE_TITLE}} recommends that
the Stream be frozen across a call to @manpage{@b{strqget}(9)}, but it is not
required.

@item @manref{@b{strqset}(9)}
Sets attributes of a @acronym{STREAMS} message queue.
In the UP environment, it was possible to directly manipulate streamtab or queue
structures after suppressing interrupts.  The @manpage{@b{strqset}(9)} utility
provides a mechanism for manipulating these structures in the MP environment.
Some implementations conflict on whether a Stream must first be frozen with
@manpage{@b{freezestr}(9)} or not.  @cite{@value{PACKAGE_TITLE}} recommends that
the Stream be frozen across a call to @manpage{@b{strqset}(9)}, but it is not
required.

@item @manref{@b{unfreezestr}(9)}
Thaw the state of a stream queue.
@manpage{@b{unfreezestr}(9)} was provided in the MP environment to behave in the
same fashion as @manpage{@b{splx}(9)} did in the UP environment.

@end table

@subsection DDI/DKI Functions
@cindex DDI/DKI functions

Traditionally, @cite{SVR 4} provided some DDI/DKI (Device Driver Interface/Driver Kernel Interface)
functions for use by device drivers, including @acronym{STREAMS} device drivers.  Many of these function
have survived into kernel/driver interfaces today in one form or another.  Some implementations
(particularly @cite{Solaris@registeredsymbol{}}) provide a wide array of additional DDI/DKI functions.
Additional functions are supported by Compatibility Modules, and the base @cite{SVR 4} functions are
provided by the base @cite{@value{PACKAGE_TITLE}} package.

@table @asis

@item @manref{@b{kmem_alloc}(9)}
Allocate kernel memory.

@item @manref{@b{kmem_free}(9)}
Deallocates kernel memory.

@item @manref{@b{kmem_zalloc}(9)}
Allocate and zero kernel memory.

@item @manref{@b{cmn_err}(9)}
Print a kernel command error.

@item @manref{@b{bcopy}(9)}
Copy byte strings.
This is the basic BSD-style function for copying bytes.  Traditionally @acronym{STREAMS} has used the
BSD-style function @manpage{@b{bcopy}(9)} instead of the SVR3-style
@manpage{@b{memcpy}(9)}.@footnote{Perhaps this has something to do with @acronym{STREAMS} first being
implemented on BSD 4.2.}

@item @manref{@b{bzero}(9)}
Zero a byte string.
This is the basic BSD-style function for zeroing bytes.  Traditionally @acronym{STREAMS} has used the
BSD-style function @manpage{@b{bzero}(9)} instead of the SVR3-style
@manpage{@b{memset}(9)}.@footnote{Perhaps this has something to do with @acronym{STREAMS} first being
implemented on BSD 4.2.}

@item @manref{@b{copyin}(9)}
Copy user data in from user space to kernel space.
In the UP environment, the top module put procedure was called in user context and it was possible
to copy bytes directly from the user and block in this context.  In the MP environment and with an
MP @acronym{STREAMS} synchronization model, the top module put procedure could be called outside of the
Stream head user context.  Therefore, this function has little use under @acronym{STREAMS}.

@item @manref{@b{copyout}(9)}
Copy user data in from kernel space to user space.
In the UP environment, the top module put procedure was called in user context and it was possible
to copy bytes directly to the user and block in this context.  In the MP environment and with an
MP @acronym{STREAMS} synchronization model, the top module put procedure could be called outside of the
Stream head user context.  Therefore, this function has little use under @acronym{STREAMS}.

@item @manref{@b{delay}(9)}
Postpone the calling process for a number of clock ticks.

@item @manref{@b{drv_getparm}(9)}
Driver retrieve kernel parameter.

@item @manref{@b{drv_hztomsec}(9)}
Convert kernel tick time between microseconds or milliseconds.

@item @manref{@b{drv_htztousec}(9)}
Convert kernel tick time between microseconds or milliseconds.

@item @manref{@b{drv_msectohz}(9)}
Convert kernel tick time between microseconds or milliseconds.

@item @manref{@b{drv_priv}(9)}
Check if the current process is privileged.

@item @manref{@b{drv_usectohz}(9)}
Convert kernel tick time between microseconds or milliseconds.

@item @manref{@b{drv_usecwait}(9)}
Delay for a number of microseconds.

@item @manref{@b{min}(9)}
Determine the minimum of two integers.

@item @manref{@b{max}(9)}
Determine the maximum of two integers.

@item @manref{@b{getmajor}(9)}
Get the internal major device number for a device.

@item @manref{@b{getminor}(9)}
Get the extended minor device number for a device.

@item @manref{@b{makedevice}(9)}
Create a device from a major and minor device numbers.

@item @manref{@b{strlog}(9)}
Pass a message to the @acronym{STREAMS} logger.

@item @manref{@b{timeout}(9)}
Start a timer.
Although general purpose in nature, the @manpage{@b{timeout}(9)} and @manpage{@b{untimeout}(9)}
utilities were most often used for @acronym{STREAMS} modules and drivers.  Some implementations only
support these functions for @acronym{STREAMS}.

@item @manref{@b{untimeout}(9)}
Stop a timer.
Although general purpose in nature, the @manpage{@b{timeout}(9)} and @manpage{@b{untimeout}(9)}
utilities were most often used for @acronym{STREAMS} modules and drivers.  Some implementations only
support these functions for @acronym{STREAMS}.

@end table

@table @asis

@item @manref{@b{mknod}(9)}
Make block or character special files.

@item @manref{@b{mount}(9)}
Mount and unmount file systems.

@item @manref{@b{umount}(9)}
Mount and unmount file systems.

@item @manref{@b{unlink}(9)}
Remove a file.

@end table

@subsection Some Common Extension Functions
@cindex some common extension functions

One of the most common extension functions is the ability to put a control
message with two bytes as parameters.  At some point the
@manpage{@b{M_ERROR}(9)} message was extended to include a separate error code
for the Stream head write and read side.  Also, at some point the
@manpage{@b{M_FLUSH}(9)} message was extended to include a band number as well
as a flag byte.  @manpage{@b{putctl2}(9)} and @manpage{@b{putnextctl2}(9)} were
provided to accept and generate two arguments instead of one as their
@manpage{@b{putctl1}(9)} and @manpage{@b{putnextctl1}(9)} counterparts provide.
@cite{@value{PACKAGE_TITLE}} supports these functions as part of the base
package.

Another common extension of @cite{OSF/1} or @cite{Mentat} derived @acronym{STREAMS}
implementations is the ability to weld two queues together in pipe- or FIFO-like
arrangements while maintaining queue synchronization.  The two utilities
@manpage{@b{weldq}(9)} and @manpage{@b{unweldq}(9)} were often included to
provide this facility.  @cite{@value{PACKAGE_TITLE}} supports these functions as
part of the base package.

@table @asis

@item @manref{@b{linkmsg}(9)}
Link a message block to a @acronym{STREAMS} message.

@item @manref{@b{putctl2}(9)}
Put a two byte control message on a @acronym{STREAMS} message queue.

@item @manref{@b{putnextctl2}(9)}
Put a two byte control message on the downstream @acronym{STREAMS} message queue.

@item @manref{@b{weldq}(9)}
Weld two (or four) queues together.

@item @manref{@b{unweldq}(9)}
Unweld two (or four) queues.

@end table

@subsection Some Internal Functions
@cindex some internal functions

@cite{@value{PACKAGE_TITLE}} exposes some internal @acronym{STREAMS} functions that
are exposed by many @acronym{STREAMS} implementations but which are not documented
as available to the @acronym{STREAMS} module and driver writer.  These functions are
exposed for the purpose of compatibility with other implementations as well as
providing some functions that are necessary to implement enhanced Stream heads,
specialized drivers or modules such as the @manref{@b{clone}(4)} driver or
@manref{@b{connld}(4)} module.

Following are some of the exposed functions that are typically exposed by other
@acronym{STREAMS} implementations as well:

@table @asis

@item @manref{@b{allocq}(9)}
Allocate a @acronym{STREAMS} queue pair.

@item @manref{@b{bcanget}(9)}
Test for message arrival on a band on a stream.

@item @manref{@b{canget}(9)}
Test for message arrival on a stream.

@item @manref{@b{freeq}(9)}
Deallocate a @acronym{STREAMS} queue pair.

@item @manref{@b{qattach}(9)}
Attach a module onto a @acronym{STREAMS} file.

@item @manref{@b{qclose}(9)}
Close a @acronym{STREAMS} module or driver.

@item @manref{@b{qdetach}(9)}
Detach a module from a @acronym{STREAMS} file.

@item @manref{@b{qopen}(9)}
Call a @acronym{STREAMS} module or driver open routine.

@item @manref{@b{setq}(9)}
Set sizes and procedures associated with a @acronym{STREAMS} message queue.

@end table

@subsection Some Oddball Functions
@cindex some oddball functions

@table @asis

@item @manref{@b{appq}(9)}
Append one @acronym{STREAMS} message after another.

@item @manref{@b{esbbcall}(9)}
Install a buffer callback for an extended @acronym{STREAMS} message block.

@item @manref{@b{isdatablk}(9)}
Test a @acronym{STREAMS} data block for data type.

@item @manref{@b{isdatamsg}(9)}
Test a @acronym{STREAMS} data block for data type.

@item @manref{@b{kmem_zalloc_node}(9)}
Allocate and zero a NUMA memory extent.

@item @manref{@b{msgsize}(9)}
Calculate the size of the message blocks in a @acronym{STREAMS} message.

@item @manref{@b{qcountstrm}(9)}
Add all counts on all @acronym{STREAMS} message queues in a stream.

@item @manref{@b{xmsgsize}(9)}
Calculate the size of message blocks in a @acronym{STREAMS} message.

@end table

@page
@node Porting from SVR 3.2
@section Porting from SVR 3.2
@cindex Porting from SVR 3.2

Detailed portability information for porting @acronym{STREAMS} modules and drivers
from @cite{SVR 3.2} to @cite{@value{PACKAGE_TITLE}} is contained the the
@cite{@acronym{STREAMS} Compatibility Modules} package, @file{strcompat}, under the
@manref{@b{svr3compat}(9)} manual page.  The @cite{@acronym{STREAMS} Compatibility
Modules} package also provides some @cite{SVR 3.2} specific compatibility
functions.

@menu
* Differences from SVR 3.2::
* Commonalities with SVR 3.2::
* Compatibility functions for SVR 3.2::
* Configuration ala SVR 3.2::
@end menu

This section captures portability information for @cite{SVR 3.2} based systems.
If the operating system from which you are porting more closely fits one of the
other portability sections, please see that section.

For the most part, porting from @cite{SVR 3.2} to @cite{@value{PACKAGE_TITLE}}
is not much different than porting forward from @cite{SVR 3.2} to @cite{SVR 4.2
MP}.  If you wish to be able to access some backward compatible @cite{SVR 3.2}
functions, use the @cite{SVR 3} Compatibility Module from the @file{strcompat}
package.

Therefore, it is recommended that @acronym{STREAMS} modules and drivers for
@cite{SVR 3.2} be ported forward to @cite{SVR 4.2 MP} before being ported to
@cite{@value{PACKAGE_TITLE}}.


@node Differences from SVR 3.2
@subsection Differences from SVR 3.2
@cindex Differences from SVR 3.2

The most significant different in @cite{SVR 3.2} and @cite{SVR 4} was the
declaration of the queue open and close routine entry points.  Some
@acronym{STREAMS} implementations still support both @cite{SVR 3.2} entry point
declarations as well as @cite{SVR 4} entry point declarations.
@cite{@value{PACKAGE_TITLE}} only supports the @cite{SVR 4} style entry points.

@cite{SVR 3.2} was not MP-safe.  @cite{@value{PACKAGE_TITLE}} is MP-safe.

A significant number of utilities were implemented in @cite{SVR 3.2} as
architecture dependent macros.  In @cite{SVR 4} these became architecture
independent function calls.

In general, @cite{@value{PACKAGE_TITLE}} is different from @cite{SVR 3.2} in any
way that @cite{SVR 3.2} is different from @cite{SVR 4.2 MP}.

@node Commonalities with SVR 3.2
@subsection Commonalities with SVR 3.2
@cindex Commonalities with SVR 3.2

In general, most of the @acronym{STREAMS} utility functions that were present in
@cite{SVR 3.2} also made it into @cite{SVR 4} (with few exceptions).  @cite{SVR
3.2} did not yet have the concept of a DDI/DKI, but the @acronym{STREAMS} functions
present in @cite{SVR 3.2} appear in the @cite{SVR 4.2 MP} DDI/DKI.

@node Compatibility functions for SVR 3.2
@subsection Compatibility functions for SVR 3.2
@cindex Compatibility functions for SVR 3.2

@table @asis

@item @manref{@b{alloc_proto}(9)}
Allocate control and data message blocks.

@item @manref{@b{emajor}(9)}
Get the external (real) major device number from the device number.

@item @manref{@b{eminor}(9)}
Get the external extended minor device number from the device number.

@end table

@node Configuration ala SVR 3.2
@subsection Configuration ala SVR 3.2
@cindex Configuration ala SVR 3.2

I have never seen a description of @cite{SVR 3.2} @acronym{STREAMS} configuration.
I can only assume that it involved relinking the kernel in some fashion.

@page
@node Porting from SVR 4.2 MP
@section Porting from SVR 4.2 MP
@cindex Porting from SVR 4.2 MP

Detailed portability information for porting @acronym{STREAMS} modules and drivers
from @cite{SVR 4.2 MP} to @cite{@value{PACKAGE_TITLE}} is contained the the
@cite{@acronym{STREAMS} Compatibility Modules} package, @file{strcompat}, under the
@manref{@b{svr4compat}(9)} manual page.  The @cite{@acronym{STREAMS} Compatibility
Modules} package also provides some @cite{SVR 4.2 MP} specific compatibility
functions.

This section captures portability information for SVR 4.2 MP based systems.  If
the operating system from which you are porting more closely fits one of the
other portability sections, please see that section.

@menu
* Differences from SVR 4.2 MP::
* Commonalities with SVR 4.2 MP::
* Compatibility functions for SVR 4.2 MP::
* Configuration ala SVR 4.2 MP::
@end menu

@node Differences from SVR 4.2 MP
@subsection Differences from SVR 4.2 MP
@cindex differences from svr 4.2 mp

@cite{@value{PACKAGE_TITLE}} has very few differences from @cite{SVR 4.2 MP}.
Not all @cite{SVR 4.2 MP} functions are implemented in the base
@cite{@value{PACKAGE_TITLE}} kernel modules.  Some functions are included in the
@cite{SVR 4.2 MP} Compatibility Module (@file{streams_svr4compat.ko}) from the
@file{strcompat} package.

@subsubsection Priority Levels
@cindex priority levels

@b{Linux} has a different concept of priority levels than @cite{SVR 4.2 MP}.
@b{Linux} has basically 4 priority levels as follows:

@enumerate
@item Preemptive

At this priority level, software and hardware interrupts are enabled and the
kernel is executing with preemption enabled.  This means that the currently
executing kernel thread could preempt and sleep in favour of another thread of
kernel execution.

This priority level only exists on preemptive (mostly 2.6 and 3.x) kernels.

@item Non-Preemptive

At this priority level, software and hardware interrupts are enabled and the
kernel is executing with preemption disabled.  This means that the currently
executing kernel thread will only be interrupted by software or hardware
interrupts.

This priority level exists in all kernels.

@item Software Interrupts Disabled

At this priority level, software interrupts are disabled and the kernel is
executing with preemption disabled.  This means that the currently executing
kernel thread will only be interrupted by hardware interrupts.

This is the case when the executing thread is processing a software interrupt,
or when the currently executing thread has disabled software interrupts.

This priority level exists in all kernels.

@item Interrupt Service Routines Disabled

At this priority level, hardware interrupts are disabled and the kernel is
executing with preemption disabled.  This means that the currently executing
kernel thread will not be interrupted.

This is the case when the executing thread is processing a hardware interrupt,
or when the currently executing thread has disabled hardware interrupts.

This priority level exists in all kernels.

@end enumerate

@node Commonalities with SVR 4.2 MP
@subsection Commonalities with SVR 4.2 MP
@cindex commonalities with svr 4.2 mp

@node Compatibility functions for SVR 4.2 MP
@subsection Compatibility functions for SVR 4.2 MP
@cindex compatibility functions for svr 4.2 mp

@subsubsection STREAMS Locks

@acronym{STREAMS} locks are those that are mentioned in the @cite{SVR 4 Programmer's Guide -- STREAMS}.
These locks lock a queue or Stream head for exclusive access.  @cite{@value{PACKAGE_TITLE}}
implements queue and Stream head locks as read-write locks, so these locks translate to taking a
write lock on the queue or Stream head.
These locks are not normally used by @acronym{STREAMS} modules and drivers and are therefore left in the
@cite{SVR 4.2 MP} Compatibility Module, @file{streams_svr4compat.ko}, from the @acronym{STREAMS}
Compatibility Modules package, @file{strcompat}.

@table @asis

@item @manref{@b{MPSTR_QLOCK}(9)}
Release a queue from exclusive access.

@item @manref{@b{MPSTR_QRELE}(9)}
Acquire a queue for exclusive access.

@item @manref{@b{MPSTR_STPLOCK}(9)}
Acquire a stream head for exclusive access.

@item @manref{@b{MPSTR_STPRELE}(9)}
Release a stream head from exclusive access.

@end table

@subsubsection Basic Locks

Basic locks are similar to @cite{Linux} spin locks and can be used as an ABI replacement for
@cite{Linux} spin locks.
It is rather typical for @cite{OpenSS7 Project} @acronym{STREAMS} modules and drivers to use
@cite{Linux} spin locks directly instead of via these functions.  Therefore these locks are left in
the @cite{SVR 4.2 MP} Compatibility Module, @file{streams_svr4compat.ko}, from the @acronym{STREAMS}
Compatibility Modules package, @file{strcompat}.

@table @asis

@item @manref{@b{LOCK}(9)}
Lock a basic lock.

@item @manref{@b{LOCK_ALLOC}(9)}
Allocate a basic lock.

@item @manref{@b{LOCK_DEALLOC}(9)}
Deallocate a basic lock.

@item @manref{@b{LOCK_OWNED}(9)}
Determine whether a basic lock is head by the caller.

@item @manref{@b{TRYLOCK}(9)}
Try to lock a basic lock.

@item @manref{@b{UNLOCK}(9)}
Unlock a basic lock.

@end table

@subsubsection Read-Write Locks

Read-write locks are similar to @cite{Linux} read-write locks and can be used as an ABI replacement
for @cite{Linux} read-write locks.

@table @asis

@item @manref{@b{RW_ALLOC}(9)}
Allocate and initialize a read/write lock.

@item @manref{@b{RW_DEALLOC}(9)}
Deallocate a read/write lock.

@item @manref{@b{RW_RDLOCK}(9)}
Acquire a read/write lock in read mode.

@item @manref{@b{RW_TRYRDLOCK}(9)}
Attempt to acquire a read/write lock in read mode.

@item @manref{@b{RW_TRYWRLOCK}(9)}
Attempt to acquire a read/write lock in write mode.

@item @manref{@b{RW_UNLOCK}(9)}
Release a read/write lock.

@item @manref{@b{RW_WRLOCK}(9)}
Acquire a read/write lock in write mode.

@end table

@subsubsection Sleep Locks

Sleep locks are similar to @cite{Linux} semaphores or mutexes.

@table @asis

@item @manref{@b{SLEEP_ALLOC}(9)}
Allocate a sleep lock.

@item @manref{@b{SLEEP_DEALLOC}(9)}
Deallocate a sleep lock.

@item @manref{@b{SLEEP_LOCK}(9)}
Acquire a sleep lock.

@item @manref{@b{SLEEP_LOCKAVAIL}(9)}
Determine whether a sleep lock is available.

@item @manref{@b{SLEEP_LOCKOWNED}(9)}
Determine whether a sleep lock is held by the caller.

@item @manref{@b{SLEEP_LOCK_SIG}(9)}
Acquire a sleep lock.

@item @manref{@b{SLEEP_TRYLOCK}(9)}
Attempt to acquire a sleep lock.

@item @manref{@b{SLEEP_UNLOCK}(9)}
Release a sleep lock.

@end table

@subsubsection Synchronization Variables

Synchronization variables are similar to @cite{Linux} wait queues.

@table @asis

@item @manref{@b{SV_ALLOC}(9)}
Allocate a basic condition variable.

@item @manref{@b{SV_BROADCAST}(9)}
Broadcast a basic condition variable.

@item @manref{@b{SV_DEALLOC}(9)}
Deallocate a basic condition variable.

@item @manref{@b{SV_SIGNAL}(9)}
Signal a basic condition variable.

@item @manref{@b{SV_WAIT}(9)}
Wait on a basic condition variable.

@item @manref{@b{SV_WAIT_SIG}(9)}
Interruptible wait on a basic condition variable.

@end table

@subsubsection Atomic Integers

Atomic Integers are similar to @cite{Linux} atomic integers.

@table @asis

@item @manref{@b{ATOMIC_INT_ADD}(9)}
Add an integer value to an atomic integer.

@item @manref{@b{ATOMIC_INT_ALLOC}(9)}
Allocate and initalize an atomic integer.

@item @manref{@b{ATOMIC_INT_DEALLOC}(9)}
Deallocate an atomic integer.

@item @manref{@b{ATOMIC_INT_DECR}(9)}
Decrement and test an atomic integer.

@item @manref{@b{ATOMIC_INT_INCR}(9)}
Increment an atomic integer.

@item @manref{@b{ATOMIC_INT_INIT}(9)}
Initialize an atomic integer.

@item @manref{@b{ATOMIC_INT_READ}(9)}
Read an atomic integer.

@item @manref{@b{ATOMIC_INT_SUB}(9)}
Subtract and integer value from an atomic integer.

@item @manref{@b{ATOMIC_INT_WRITE}(9)}
Write an integer value to an atomic integer.

@end table

@subsubsection Set Processor Level

Processor levels are similar to @cite{Linux} local irq or soft irq suppression.

@table @asis

@item @manref{@b{spl0}(9)}
Set priority level 0.

@item @manref{@b{spl1}(9)}
Set priority level 1.

@item @manref{@b{spl2}(9)}
Set priority level 2.

@item @manref{@b{spl3}(9)}
Set priority level 3.

@item @manref{@b{spl4}(9)}
Set priority level 4.

@item @manref{@b{spl5}(9)}
Set priority level 5.

@item @manref{@b{spl6}(9)}
Set priority level 6.

@item @manref{@b{spl7}(9)}
Set priority level 7.

@item @manref{@b{spl}(9)}
Set priority level.

@item @manref{@b{splx}(9)}
Set priority level x.

@end table

@subsubsection Additional Compatibility Functions

@table @asis

@item @manref{@b{itimeout}(9)}
Perform a timeout at an interrupt level.

@item @manref{@b{lbolt}(9)}
Time in ticks since reboot.

@item @manref{@b{major}(9)}
Get the internal major number of a device.

@item @manref{@b{makedev}(9)}
Make a device number from internal major and minor device numbers.

@item @manref{@b{minor}(9)}
Get the internal minor number of a device.

@item @manref{@b{sleep}(9)}
Put a process to sleep.

@item @manref{@b{vtop}(9)}
Convert virtual to physical address.

@item @manref{@b{wakeup}(9)}
Wake a process.

@end table

@node Configuration ala SVR 4.2 MP
@subsection Configuration ala SVR 4.2 MP
@cindex configuration ala svr 4.2 mp

@page
@node Porting from AIX 5L Version 5.1
@section Porting from AIX 5L Version 5.1
@cindex Porting from AIX 5L Version 5.1

Detailed portability information for porting @acronym{STREAMS} modules and drivers
from @cite{AIX} to @cite{@value{PACKAGE_TITLE}} is contained the the
@cite{@acronym{STREAMS} Compatibility Modules} package, @file{strcompat}, under the
@manref{@b{aixcompat}(9)} manual page.  The @cite{@acronym{STREAMS} Compatibility
Modules} package also provides some @cite{AIX} specific compatibility
functions.

Most of the @acronym{STREAMS} functions and DDI/DKI functions provided by
@cite{AIX@registeredsymbol{}} are also provided by the
@cite{@value{PACKAGE_TITLE}} base package.  Some utilities, however, are
provided by the @cite{AIX} Compatibility Module (@file{streams_aixcompat.ko})
from the @acronym{STREAMS} Compatibility Module package (@file{strcompat}).

@menu
* Differences from AIX 5L Version 5.1::
* Commonalities with AIX 5L Version 5.1::
* Compatibility Functions for AIX 5L Version 5.1::
* Configuration ala AIX 5L Version 5.1::
@end menu

@node Differences from AIX 5L Version 5.1
@subsection Differences from AIX 5L Version 5.1
@cindex differences from aix 5l version 5.1

@node Commonalities with AIX 5L Version 5.1
@subsection Commonalities with AIX 5L Version 5.1
@cindex commonalities with aix 5l version 5.1

@node Compatibility Functions for AIX 5L Version 5.1
@subsection Compatibility Functions for AIX 5L Version 5.1
@cindex compatibility functions for aix 5l version 5.1

The compatibility functions described below are described in the @acronym{STREAMS}
module and driver documentation for @cite{AIX}.  Some of these functions are
provided also with other implementations (such as @cite{OSF/1} or
@cite{Mentat}).

The following functions are typically also provided by @emph{most} @acronym{STREAMS}
implementations:

@table @asis

@item @manref{@b{putctl2}(9)}
Put a 2 byte control message on a @acronym{STREAMS}.

@item @manref{@b{splstr}(9)}
Set processor level for @acronym{STREAMS}.

@item @manref{@b{splx}(9)}
Set or restore processor level.

@item @manref{@b{unweldq}(9)}
Unweld two pairs of streams queues.

@item @manref{@b{weldq}(9)}
Weld together two pairs of streams queues.

@end table

The following functions are really just @cite{Mentat Portable @acronym{STREAMS}}
functions that made their way into @cite{AIX}:  (Portability considerations for
@cite{Mentat Portable @acronym{STREAMS}} functions is described in.)

@table @asis

@item @manref{@b{mi_bufcall}(9)}
Reliable alternative to @manpage{@b{buffcall}(9)}.
This is really just a @cite{Mentat Portable @acronym{STREAMS}} function that made
its way into @cite{AIX}.

@item @manref{@b{mi_close_comm}(9)}
@acronym{STREAMS} common minor device close utility.
This is really just a @cite{Mentat Portable @acronym{STREAMS}} function that made
its way into @cite{AIX}.

@item @manref{@b{mi_next_ptr}(9)}
@acronym{STREAMS} minor device list traversal.
This is really just a @cite{Mentat Portable @acronym{STREAMS}} function that made
its way into @cite{AIX}.

@item @manref{@b{mi_open_comm}(9)}
@acronym{STREAMS} common minor device open utility.
This is really just a @cite{Mentat Portable @acronym{STREAMS}} function that made
its way into @cite{AIX}.

@item @manref{@b{mi_prev_ptr}(9)}
@acronym{STREAMS} minor device list traversal.
This is really just a @cite{Mentat Portable @acronym{STREAMS}} function that made
its way into @cite{AIX}.

@end table

The following functions are unique to @cite{AIX}:

In particular, the @manpage{@b{wantio}(9)} and @manpage{@b{wantmsg}(9)}
facilities are incredibly convoluted and complex and only documented by
@cite{AIX}.  Although @cite{@value{PACKAGE_TITLE}} implements these functions
(in the @cite{AIX} Compatibility Module, @file{streams_aixcompat.ko}, from the
@acronym{STREAMS} Compatibility Module package, @file{strcompat}) as faithfully as
possible, their use should be completely avoided by portable programs.

@table @asis

@item @manref{@b{wantio}(9)}
Perform direct I/O from a @acronym{STREAMS} driver.

@item @manref{@b{wantmsg}(9)}
Provide a filter of wanted messages from a @acronym{STREAMS} module.

@end table

@node Configuration ala AIX 5L Version 5.1
@subsection Configuration ala AIX 5L Version 5.1
@cindex configuration ala aix 5l version 5.1

@table @asis

@item @manref{@b{str_install}(9)}
Install a @acronym{STREAMS} module or driver.
Each implementation has a different mechanism for registration and
deregistration of @acronym{STREAMS} modules and drivers.  This is the mechanism
used by @cite{AIX}.  It should be avoided by programs that are not being ported
from @cite{AIX}.  @cite{AIX}-style @acronym{STREAMS} registration and deregistration
is implemented in the @cite{AIX} Compatibility Module,
@file{streams_aixcompat.ko}, from the @acronym{STREAMS} Compatibility Module package,
@file{strcompat}.

@end table

@page
@node Porting from HP-UX 11.0i v2
@section Porting from HP-UX 11.0i v2
@cindex Porting from HP-UX 11.0i v2

Detailed portability information for porting @acronym{STREAMS} modules and drivers
from @cite{HP-UX} to @cite{@value{PACKAGE_TITLE}} is contained the the
@cite{@acronym{STREAMS} Compatibility Modules} package, @file{strcompat}, under the
@manref{@b{hpuxcompat}(9)} manual page.  The @cite{@acronym{STREAMS} Compatibility
Modules} package also provides some @cite{HP-UX} specific compatibility
functions.

@menu
* Differences from HP-UX 11.0i v2::
* Commonalities with HP-UX 11.0i v2::
* Compatibility Functions for HP-UX 11.0i v2::
* Configuration ala HP-UX 11.0i v2::
@end menu

@node Differences from HP-UX 11.0i v2
@subsection Differences from HP-UX 11.0i v2
@cindex differences from hp-ux 11.0i v2

@cite{HP-UX} stubs out the @manpage{@b{qprocson}(9)},
@manpage{@b{qprocsoff}(9)}, @manpage{@b{freezestr}(9)} and
@manpage{@b{unfreezestr}(9)} utility functions.  @cite{HP-UX} expects that the
appropriate level of synchronization be used instead.@footnote{@i{STREAMS/UX for
the HP 9000 Reference Manual}, 1995, (Palo Alto, California), Hewlett-Package
Company, HP.  @url{http://docs.hp.com/}} Because of this, it is recommended that
@cite{HP-UX} drivers and modules port directly to the
@cite{@value{PACKAGE_TITLE}} environment, not be run at synchronization level
@var{SQLVL_NOP}.  See @manref{@b{str_install_HPUX}(9)}.

@node Commonalities with HP-UX 11.0i v2
@subsection Commonalities with HP-UX 11.0i v2
@cindex commonalities with hp-ux 11.0i v2

@node Compatibility Functions for HP-UX 11.0i v2
@subsection Compatibility Functions for HP-UX 11.0i v2
@cindex compatibility functions for hp-ux 11.0i v2

The following compatibility functions are typical extensions and are also
provided by the @cite{@value{PACKAGE_TITLE}} base package:

@table @asis

@item @manref{@b{putctl2}(9)}
put a 2 byte control message on a @acronym{STREAMS} message queue

@item @manref{@b{putnextctl2}(9)}
put a 2 byte control message on the downstream @acronym{STREAMS} message queue

@item @manref{@b{unweldq}(9)}
unweld two pairs of streams queues

@item @manref{@b{weldq}(9)}
weld together two pairs of streams queues

@end table

The following compatibility functions are peculiar to
@cite{HP-UX}@footnote{@i{STREAMS/UX for the HP 9000 Reference Manual}, 1995,
(Palo Alto, California), Hewlett-Package Company, HP.
@url{http://docs.hp.com/}} and are only part of the @cite{HP-UX} compatibility
module, @file{streams_hpuxcompat.ko}, from the @acronym{STREAMS} Compatibility
Modules, @file{strcompat}, package:

@table @asis

@item @manref{@b{get_sleep_lock}(9)}
Provide access to the global sleep lock.

@item @manref{@b{streams_get_sleep_lock}(9)}
Provide access to the global sleep lock.

@item @manref{@b{streams_mpsleep}(9)}
Put a process to sleep.

@item @manref{@b{streams_put}(9)}
Invoke the put procedure for a @acronym{STREAMS} module or driver with a @acronym{STREAMS} message.

@end table


@node Configuration ala HP-UX 11.0i v2
@subsection Configuration ala HP-UX 11.0i v2
@cindex configuration ala hp-ux 11.0i v2

Installation, registration and deregistration of @acronym{STREAMS} modules and
drivers is one of the least standardized mechanisms across the various
@acronym{STREAMS} implementations.  Each implementation has its own mechanism and
@cite{HP-UX} is no different.  The following compatibility functions provide the
@cite{HP-UX} specific @acronym{STREAMS} driver installation, registration and
deregistration style:

@table @asis

@item @manref{@b{str_install}(9)}
Install a @acronym{STREAMS} module or driver.

@item @manref{@b{str_uninstall}(9)}
Uninstall a @acronym{STREAMS} module or driver.

@end table

@page
@node Porting from OSF/1 1.2/Digital UNIX
@section Porting from OSF/1 1.2/Digital UNIX
@cindex Porting from OSF/1 1.2/Digital UNIX

Detailed portability information for porting @acronym{STREAMS} modules and drivers
from @cite{OSF/1} to @cite{@value{PACKAGE_TITLE}} is contained the the
@cite{@acronym{STREAMS} Compatibility Modules} package, @file{strcompat}, under the
@manref{@b{osfcompat}(9)} manual page.  The @cite{@acronym{STREAMS} Compatibility
Modules} package also provides some @cite{OSF/1} specific compatibility
functions.

@menu
* Differences from OSF/1 1.2/Digial UNIX::
* Commonalities with OSF/1 1.2/Digial UNIX::
* Compatibility Functions for OSF/1 1.2/Digial UNIX::
* Configuration ala OSF/1 1.2/Digial UNIX::
@end menu

@node Differences from OSF/1 1.2/Digial UNIX
@subsection Differences from OSF/1 1.2/Digial UNIX
@cindex differences from osf/1 1.2/digial unix

@node Commonalities with OSF/1 1.2/Digial UNIX
@subsection Commonalities with OSF/1 1.2/Digial UNIX
@cindex commonalities with osf/1 1.2/digial unix

@node Compatibility Functions for OSF/1 1.2/Digial UNIX
@subsection Compatibility Functions for OSF/1 1.2/Digial UNIX
@cindex compatibility functions for osf/1 1.2/digial unix

@table @asis

@item @manref{@b{unweldq}(9)}
Unweld two pairs of streams queues.

@item @manref{@b{weldq}(9)}
Weld together two pairs of streams queues.

@end table

@table @asis

@item @manref{@b{lbolt}(9)}
Time in ticks since reboot.

@item @manref{@b{puthere}(9)}
Invoke the put procedure for a @acronym{STREAMS} module or driver with a @acronym{STREAMS} message.

@item @manref{@b{streams_close_comm}(9)}
Common minor device close utility.

@item @manref{@b{streams_open_comm}(9)}
Common minor device open utility.

@item @manref{@b{streams_open_ocomm}(9)}
Common minor device open utility.

@item @manref{@b{time}(9)}
(undoc)

@end table

@node Configuration ala OSF/1 1.2/Digial UNIX
@subsection Configuration ala OSF/1 1.2/Digial UNIX
@cindex configuration ala osf/1 1.2/digial unix

@table @asis

@item @manref{@b{strmod_add}(9)}
Add a @acronym{STREAMS} module.

@item @manref{@b{strmod_del}(9)}
Delete a @acronym{STREAMS} module or driver from the kernel.

@end table

@page
@node Porting from UnixWare 7.1.3 (OpenUnix 8)
@section Porting from UnixWare 7.1.3 (OpenUnix 8)
@cindex Porting from UnixWare 7.1.3 (OpenUnix 8)

Detailed portability information for porting @acronym{STREAMS} modules and drivers
from @cite{UnixWare} to @cite{@value{PACKAGE_TITLE}} is contained the the
@cite{@acronym{STREAMS} Compatibility Modules} package, @file{strcompat}, under the
@manref{@b{uw7compat}(9)} manual page.  The @cite{@acronym{STREAMS} Compatibility
Modules} package also provides some @cite{UnixWare} specific compatibility
functions.

@menu
* Differences from UnixWare 7.1.3 (OpenUnix 8)::
* Commonalities with UnixWare 7.1.3 (OpenUnix 8)::
* Compatibility Functions for UnixWare 7.1.3 (OpenUnix 8)::
* Configuration ala UnixWare 7.1.3 (OpenUnix 8)::
@end menu

@node Differences from UnixWare 7.1.3 (OpenUnix 8)
@subsection Differences from UnixWare 7.1.3 (OpenUnix 8)
@cindex differences from unixware 7.1.3 (openunix 8)

@node Commonalities with UnixWare 7.1.3 (OpenUnix 8)
@subsection Commonalities with UnixWare 7.1.3 (OpenUnix 8)
@cindex commonalities with unixware 7.1.3 (openunix 8)

@node Compatibility Functions for UnixWare 7.1.3 (OpenUnix 8)
@subsection Compatibility Functions for UnixWare 7.1.3 (OpenUnix 8)
@cindex compatibility functions for unixware 7.1.3 (openunix 8)

The following compatibility functions are in addition to all SVR 4.2
compatibility functions.

@table @asis

@item @manref{@b{allocb_physreq}(9)}
Allocate a @acronym{STREAMS} message and data block.

@item @manref{@b{emajor}(9)}
Get the external (real) major device number from the device number.

@item @manref{@b{eminor}(9)}
Get the external extended minor device number from the device number.

@item @manref{@b{etoimajor}(9)}
Convert an external major device number to an internal major device number.

@item @manref{@b{getemajor}(9)}
Get the external (real) major device number.

@item @manref{@b{geteminor}(9)}
Get the external minor device number.

@item @manref{@b{itoemajor}(9)}
Convert an internal major device number to an external major device number.

@item @manref{@b{msgphysreq}(9)}
Cause a message block to meet physical requirements.

@item @manref{@b{msgpullup_physreq}(9)}
Pull up bytes in a @acronym{STREAMS} message.

@item @manref{@b{msgscgth}(9)}
(undoc)

@item @manref{@b{strioccall}(9)}
(undoc)

@end table

@node Configuration ala UnixWare 7.1.3 (OpenUnix 8)
@subsection Configuration ala UnixWare 7.1.3 (OpenUnix 8)
@cindex configuration ala unixware 7.1.3 (openunix 8)

@page
@node Porting from Solaris 9/SunOS 5.9
@section Porting from Solaris 9/SunOS 5.9
@cindex Porting from Solaris 9/SunOS 5.9

Detailed portability information for porting @acronym{STREAMS} modules and drivers
from @cite{Solaris} to @cite{@value{PACKAGE_TITLE}} is contained the the
@cite{@acronym{STREAMS} Compatibility Modules} package, @file{strcompat}, under the
@manref{@b{suncompat}(9)} manual page.  The @cite{@acronym{STREAMS} Compatibility
Modules} package also provides some @cite{Solaris} specific compatibility
functions.

@menu
* Differences from Solaris 9/SunOS 5.9::
* Commonalities with Solaris 9/SunOS 5.9::
* Compatibility Functions for Solaris 9/SunOS 5.9::
* Configuration ala Solaris 9/SunOS 5.9::
@end menu

@node Differences from Solaris 9/SunOS 5.9
@subsection Differences from Solaris 9/SunOS 5.9
@cindex differences from solaris 9/sunos 5.9

@node Commonalities with Solaris 9/SunOS 5.9
@subsection Commonalities with Solaris 9/SunOS 5.9
@cindex commonalities with solaris 9/sunos 5.9

@node Compatibility Functions for Solaris 9/SunOS 5.9
@subsection Compatibility Functions for Solaris 9/SunOS 5.9
@cindex compatibility functions for solaris 9/sunos 5.9

@table @asis

@item @manref{@b{ddi_create_minor_node}(9)}
Create a minor node for this device.

@item @manref{@b{ddi_driver_major}(9)}
Find the major device number associated with a driver.

@item @manref{@b{ddi_driver_name}(9)}
Return normalized driver name.

@item @manref{@b{ddi_get_cred}(9)}
Get a reference to the credentials of the current user.

@item @manref{@b{ddi_getiminor}(9)}

@item @manref{@b{ddi_get_instance}(9)}
Get device instance number.

@item @manref{@b{ddi_get_lbolt}(9)}
Get the current value of the system tick clock.

@item @manref{@b{ddi_get_pid}(9)}

@item @manref{@b{ddi_get_soft_state}(9)}

@item @manref{@b{ddi_get_time}(9)}
Get the current time in seconds since the epoch.

@item @manref{@b{ddi_remove_minor_node}(9)}
Remove a minor node for a device.

@item @manref{@b{ddi_removing_power}(9)}

@item @manref{@b{ddi_soft_state}(9)}

@item @manref{@b{ddi_soft_state_fini}(9)}

@item @manref{@b{ddi_soft_state_free}(9)}

@item @manref{@b{ddi_soft_state_init}(9)}

@item @manref{@b{ddi_soft_state_zalloc}(9)}

@item @manref{@b{ddi_umem_alloc}(9)}
Allocate page aligned kernel memory.

@item @manref{@b{ddi_umem_free}(9)}

@item @manref{@b{power}(9)}
Power a device attached to the system.

@item @manref{@b{probe}(9)}

@item @manref{@b{qbufcall}(9)}
Install a buffer callback.

@item @manref{@b{qtimeout}(9)}
Start a timer associated with a queue.

@item @manref{@b{queclass}(9)}

@item @manref{@b{qunbufcall}(9)}

@item @manref{@b{quntimeout}(9)}

@item @manref{@b{qwait}(9)}
Wait for a queue message.

@item @manref{@b{qwait_sig}(9)}
Wait for a queue message or signal.

@item @manref{@b{qwriter}(9)}

@end table

@node Configuration ala Solaris 9/SunOS 5.9
@subsection Configuration ala Solaris 9/SunOS 5.9
@cindex configuration ala solaris 9/sunos 5.9

@table @asis

@item @manref{@b{_fini}(9)}

@item @manref{@b{_info}(9)}

@item @manref{@b{_init}(9)}

@item @manref{@b{attach}(9)}
Attach a device to the system or resume a suspended device.

@item @manref{@b{detach}(9)}
Detach a device from the system or suspend a device.

@item @manref{@b{getinfo}(9)}

@item @manref{@b{identify}(9)}
Determine if a driver is associated with a device.

@item @manref{@b{install_driver}(9)}
Install a device driver.

@item @manref{@b{mod_info}(9)}
Provides information on a loadable kernel module to the @acronym{STREAMS} executive.

@item @manref{@b{mod_install}(9)}
Installs a loadable kernel module in the @acronym{STREAMS} executive.

@item @manref{@b{mod_remove}(9)}
Removes a loadable module from the @acronym{STREAMS} executive.

@end table

@page
@node Porting from SUPER-UX
@section Porting from SUPER-UX
@cindex Porting from SUPER-UX

Detailed portability information for porting @acronym{STREAMS} modules and drivers
from @cite{SUPER-UX} to @cite{@value{PACKAGE_TITLE}} is contained the the
@cite{@acronym{STREAMS} Compatibility Modules} package, @file{strcompat}, under the
@manref{@b{suxcompat}(9)} manual page.  The @cite{@acronym{STREAMS} Compatibility
Modules} package also provides some @cite{SUPER-UX} specific compatibility
functions.

@menu
* Differences from SUPER-UX::
* Commonalities with SUPER-UX::
* Compatibility Functions for SUPER-UX::
* Configuration ala SUPER-UX::
@end menu

@node Differences from SUPER-UX
@subsection Differences from SUPER-UX
@cindex differences from super-ux

@node Commonalities with SUPER-UX
@subsection Commonalities with SUPER-UX
@cindex commonalities with super-ux

@node Compatibility Functions for SUPER-UX
@subsection Compatibility Functions for SUPER-UX
@cindex compatibility functions for super-ux

@table @asis

@item @manref{@b{lbolt}(9)}
Time in ticks since reboot.

@end table

@node Configuration ala SUPER-UX
@subsection Configuration ala SUPER-UX
@cindex configuration ala super-ux

@page
@node Porting from UXP/V
@section Porting from UXP/V
@cindex Porting from UXP/V

Detailed portability information for porting @acronym{STREAMS} modules and drivers
from @cite{UXP/V} to @cite{@value{PACKAGE_TITLE}} is contained the the
@cite{@acronym{STREAMS} Compatibility Modules} package, @file{strcompat}, under the
@manref{@b{uxpcompat}(9)} manual page.  The @cite{@acronym{STREAMS} Compatibility
Modules} package also provides some @cite{UXP/V} specific compatibility
functions.

@menu
* Differences from UXP/V::
* Commonalities with UXP/V::
* Compatibility Functions for UXP/V::
* Configuration ala UXP/V::
@end menu

@node Differences from UXP/V
@subsection Differences from UXP/V
@cindex differences from uxp/v

@node Commonalities with UXP/V
@subsection Commonalities with UXP/V
@cindex commonalities with uxp/v

@node Compatibility Functions for UXP/V
@subsection Compatibility Functions for UXP/V
@cindex compatibility functions for uxp/v

@node Configuration ala UXP/V
@subsection Configuration ala UXP/V
@cindex configuration ala uxp/v

@page
@node Porting from Mac Open Transport
@section Porting from Mac Open Transport
@cindex Porting from Mac Open Transport

Detailed portability information for porting @acronym{STREAMS} modules and drivers
from @cite{Mac Open Transport} to @cite{@value{PACKAGE_TITLE}} is contained the the
@cite{@acronym{STREAMS} Compatibility Modules} package, @file{strcompat}, under the
@manref{@b{maccompat}(9)} manual page.  The @cite{@acronym{STREAMS} Compatibility
Modules} package also provides some @cite{Mac Open Transport} specific compatibility
functions.

@menu
* Differences from Mac Open Transport::
* Commonalities with Mac Open Transport::
* Compatibility Functions for Mac Open Transport::
* Configuration ala Mac Open Transport::
@end menu

@node Differences from Mac Open Transport
@subsection Differences from Mac Open Transport
@cindex differences from mac open transport

@node Commonalities with Mac Open Transport
@subsection Commonalities with Mac Open Transport
@cindex commonalities with mac open transport

@node Compatibility Functions for Mac Open Transport
@subsection Compatibility Functions for Mac Open Transport
@cindex compatibility functions for mac open transport

@node Configuration ala Mac Open Transport
@subsection Configuration ala Mac Open Transport
@cindex configuration ala mac open transport

@page
@node Porting from Mentat Portable STREAMS
@section Porting from Mentat Portable STREAMS
@cindex Porting from Mentat Portable STREAMS

Detailed portability information for porting @acronym{STREAMS} modules and drivers
from @cite{Mentat Portable STREAMS} to @cite{@value{PACKAGE_TITLE}} is contained the the
@cite{@acronym{STREAMS} Compatibility Modules} package, @file{strcompat}, under the
@manref{@b{mpscompat}(9)} manual page.  The @cite{@acronym{STREAMS} Compatibility
Modules} package also provides some @cite{Mentat Portable STREAMS} specific compatibility
functions.

@menu
* Differences from Mentat Portable STREAMS::
* Commonalities with Mentat Portable STREAMS::
* Compatibility Functions for Mentat Portable STREAMS::
* Configuration ala Mentat Portable STREAMS::
@end menu

@node Differences from Mentat Portable STREAMS
@subsection Differences from Mentat Portable STREAMS
@cindex differences from mentat portable streams

@node Commonalities with Mentat Portable STREAMS
@subsection Commonalities with Mentat Portable STREAMS
@cindex commonalities with mentat portable streams

@node Compatibility Functions for Mentat Portable STREAMS
@subsection Compatibility Functions for Mentat Portable STREAMS
@cindex compatibility functions for mentat portable streams

@table @asis

@item @manref{@b{mi_alloc}(9)}
Allocate and free kernel memory without later regard to size.

@item @manref{@b{mi_allocq}(9)}
@manpage{@b{allocq}(9)} replacement.

@item @manref{@b{mi_alloc_sleep}(9)}
@manpage{@b{kmem_alloc}(9)} replacement.

@item @manref{@b{mi_attach}(9)}
Associate instance data with a @acronym{STREAMS} queue.

@item @manref{@b{mi_bcmp}(9)}
@manpage{@b{bcmp}(9)} replacement.

@item @manref{@b{mi_bufcall}(9)}
Reliable alternative to @manpage{@b{bufcall}(9)}.

@item @manref{@b{mi_close_comm}(9)}
@acronym{STREAMS} common minor device close utility.

@item @manref{@b{mi_close_detached}(9)}
Release instance data from the @acronym{STREAMS} queue and perform close cleanup.

@item @manref{@b{mi_close_free}(9)}
Free a @acronym{STREAMS} driver or module instance on close.

@item @manref{@b{mi_copy_done}(9)}
@manpage{@b{ioctl}(2s)} complete.

@item @manref{@b{mi_copyin}(9)}
Copy data to a user buffer.

@item @manref{@b{mi_copyin_n}(9)}
Copy data to a user buffer.

@item @manref{@b{mi_copyout}(9)}
Copy data from a user buffer.

@item @manref{@b{mi_copyout_alloc}(9)}
Allocate a buffer to be copied out using @manpage{@b{mi_copyout}(9)}.

@item @manref{@b{mi_copy_set_rval}(9)}
Set return value for input-output control.

@item @manref{@b{mi_copy_state}(9)}
Current state of the input-output control process.

@item @manref{@b{mi_detach}(9)}
Disassociate instance data from the @acronym{STREAMS} queue.

@item @manref{@b{mi_first_dev_ptr}(9)}
Obtain first device instance pointer.

@item @manref{@b{mi_first_ptr}(9)}
Obtain first instance pointer.

@item @manref{@b{mi_free}(9)}
@manpage{@b{kmem_free}(9)} replacement.

@item @manref{@b{mi_freeq}(9)}
@manpage{@b{freeq}(9)} replacement.

@item @manref{@b{mi_mpprintf}(9)}
Print a formatted string to a message buffer.

@item @manref{@b{mi_mpprintf_nr}(9)}
Continue to print a formatted string to a message buffer.

@item @manref{@b{mi_next_dev_ptr}(9)}
Obtain next device instance pointer.

@item @manref{@b{mi_next_ptr}(9)}
@acronym{STREAMS} minor device list traversal.

@item @manref{@b{mi_offset_param}(9)}
Obtain parameter location within @acronym{STREAMS} message block.

@item @manref{@b{mi_offset_paramc}(9)}
Obtain parameter location within @acronym{STREAMS} message block chain.

@item @manref{@b{mi_open_alloc}(9)}
Allocate a @acronym{STREAMS} module or driver instance.

@item @manref{@b{mi_open_alloc_sleep}(9)}
Allocate a @acronym{STREAMS} module or driver instance (may sleep).

@item @manref{@b{mi_open_comm}(9)}
@acronym{STREAMS} common minor device open utility.

@item @manref{@b{mi_open_detached}(9)}
@acronym{STREAMS} create detached instance data.

@item @manref{@b{mi_open_link}(9)}
Link a @acronym{STREAMS} driver or module instance on open.

@item @manref{@b{mi_prev_ptr}(9)}
@acronym{STREAMS} minor list traversal.

@item @manref{@b{mi_timer_q_switch}(9)}
Switch @acronym{STREAMS} queues for a timer message.

@item @manref{@b{mi_reallocb}(9)}
Reallocated a @acronym{STREAMS} message block.

@item @manref{@b{mi_reuse_proto}(9)}
Reuse a @acronym{STREAMS} protocol message block.

@item @manref{@b{mi_set_sth_copyopt}(9)}
Set the @acronym{STREAMS} Stream head copy options.

@item @manref{@b{mi_set_sth_hiwat}(9)}
Set the @acronym{STREAMS} Stream head high water mark.

@item @manref{@b{mi_set_sth_lowat}(9)}
Set the @acronym{STREAMS} Stream head low water mark.

@item @manref{@b{mi_set_sth_maxblk}(9)}
Set the @acronym{STREAMS} Stream head maximum block size.

@item @manref{@b{mi_set_sth_wroff}(9)}
Set the @acronym{STREAMS} Stream head write offset.

@item @manref{@b{mi_sprintf}(9)}
@manpage{@b{sprintf}(9)} replacement.

@item @manref{@b{mi_sprintf_putc}(9)}
Put a character in a sprintf buffer.

@item @manref{@b{mi_strcmp}(9)}
@manpage{@b{strcmp}(9)} replacement.

@item @manref{@b{mi_strlen}(9)}
@manpage{@b{strlen}(9)} replacement.

@item @manref{@b{mi_strlog}(9)}
@manpage{@b{strlog}(9)} replacement.

@item @manref{@b{mi_strtol}(9)}
@manpage{@b{strtol}(9)} replacement.

@item @manref{@b{mi_timer}(9)}
Process a @acronym{STREAMS} timer.

@item @manref{@b{mi_timer_alloc}(9)}
Allocate a @acronym{STREAMS} timer.

@item @manref{@b{mi_timer_cancel}(9)}
Cancel a @acronym{STREAMS} timer.

@item @manref{@b{mi_timer_free}(9)}
Free a @acronym{STREAMS} timer.

@item @manref{@b{mi_timer_move}(9)}
Move a @acronym{STREAMS} timer.

@item @manref{@b{mi_timer_q_switch}(9)}
Switch queues for a @acronym{STREAMS} timer.

@item @manref{@b{mi_timer_stop}(9)}
Stop a @acronym{STREAMS} timer.

@item @manref{@b{mi_timer_valid}(9)}
Check a @acronym{STREAMS} timer.

@item @manref{@b{mi_zalloc}(9)}
@manpage{@b{kmem_zalloc}(9)} replacement.

@item @manref{@b{mi_zalloc_sleep}(9)}
@manpage{@b{kmem_zalloc}(9)} replacement.

@end table

@table @asis

@item @manref{@b{mi_tpi_ack_alloc}(9)}
Allocate a @manpage{@b{T_OK_ACK}(7)} or @manpage{@b{T_ERROR_ACK}(7)} primitive.

@item @manref{@b{mi_tpi_conn_con}(9)}
Generate a @manpage{@b{T_CONN_CON}(7)} primitive.

@item @manref{@b{mi_tpi_conn_ind}(9)}
Generate a @manpage{@b{T_CONN_IND}(7)} primitive.

@item @manref{@b{mi_tpi_conn_req}(9)}
Generate a @manpage{@b{T_CONN_REQ}(7)} primitive.

@item @manref{@b{mi_tpi_data_ind}(9)}
Generate a @manpage{@b{T_DATA_IND}(7)} primitive.

@item @manref{@b{mi_tpi_data_req}(9)}
Generate a @manpage{@b{T_DATA_REQ}(7)} primitive.

@item @manref{@b{mi_tpi_discon_ind}(9)}
Generate a @manpage{@b{T_DISCON_IND}(7)} primitive.

@item @manref{@b{mi_tpi_discon_req}(9)}
Generate a @manpage{@b{T_DISCON_REQ}(7)} primitive.

@item @manref{@b{mi_tpi_err_ack_alloc}(9)}
Generate a @manpage{@b{T_ERROR_ACK}(7)} primitive.

@item @manref{@b{mi_tpi_exdata_ind}(9)}
Generate a @manpage{@b{T_EXDATA_IND}(7)} primitive.

@item @manref{@b{mi_tpi_exdata_req}(9)}
Generate a @manpage{@b{T_EXDATA_REQ}(7)} primitive.

@item @manref{@b{mi_tpi_info_req}(9)}
Generate a @manpage{@b{T_INFO_REQ}(7)} primitive.

@item @manref{@b{mi_tpi_ok_ack_alloc}(9)}
Generate a @manpage{@b{T_OK_ACK}(7)} primitive.

@item @manref{@b{mi_tpi_ordrel_ind}(9)}
Generate a @manpage{@b{T_ORDREL_IND}(7)} primitive.

@item @manref{@b{mi_tpi_ordrel_req}(9)}
Generate a @manpage{@b{T_ORDREL_REQ}(7)} primitive.

@item @manref{@b{mi_tpi_uderror_ind}(9)}
Generate a @manpage{@b{T_UDERROR_IND}(7)} primitive.

@item @manref{@b{mi_tpi_unitdata_ind}(9)}
Generate a @manpage{@b{T_UNITDATA_IND}(7)} primitive.

@item @manref{@b{mi_tpi_unitdata_req}(9)}
Generate a @manpage{@b{T_UNITDATA_REQ}(7)} primitive.

@end table

@node Configuration ala Mentat Portable STREAMS
@subsection Configuration ala Mentat Portable STREAMS
@cindex configuration ala mentat portable streams

@node Development
@chapter Development
@cindex development

@menu
* Portable STREAMS Drivers and Modules::
@end menu

@node Portable STREAMS Drivers and Modules
@section Portable @acronym{STREAMS} Drivers and Modules
@cindex portable @acronym{STREAMS} drivers and modules

In the process of creating the @b{Linux Fast-STREAMS} subsystem in such a way so
as to facilitate portability of @acronym{STREAMS} drivers and modules from a wide
range of @cite{UNIX} operating system variants, a number of guidelines for the
development of portable @acronym{STREAMS} drivers and modules have been developed.
These guidelines, when adhered to, will allow the resulting driver or module to
be ported to another @acronym{STREAMS} implementation with minimal effort.
These portability guidelines are collected here.

@menu
* Memory Allocation::
* Alignment of Message Buffers::
* Disabling and Enabling Queue Procedures::
* Freezing and Unfreezing Streams::
* Passing Messages from Interrupt Service Routines::
* Timeout Call Back and Link Identifiers::
* Synchronization with Timeouts and Callback Functions::
* Synchronization with Callout Functions::
* Synchronization of Drivers and Modules::
* Special STREAMS Message Types::
* Use of Message Allocation Priorities::
* Registration/Deregistration and Device Numbering::
@end menu

@node Memory Allocation
@subsection Memory Allocation

Portable @acronym{STREAMS} modules and drivers will always allocate memory using
the SVR4 memory allocators/deallocators:
@iftex
@b{kmem_alloc}(9),
@end iftex
@ifnottex
@inforef{kmem_alloc(9), , *manpages*},
@end ifnottex
@iftex
@b{kmem_zalloc}(9)
@end iftex
@ifnottex
@inforef{kmem_zalloc(9), , *manpages*}
@end ifnottex
and
@iftex
@b{kmem_free}(9).
@end iftex
@ifnottex
@inforef{kmem_free(9), , *manpages*}.
@end ifnottex

Additional eligible allocators are:

@iftex
@b{rmallocmap}(9)
@end iftex
@ifnottex
@inforef{rmallocmap(9), , *manpages*}
@end ifnottex
@iftex
@b{rmfreemap}(9)
@end iftex
@ifnottex
@inforef{rmfreemap(9), , *manpages*}
@end ifnottex
@iftex
@b{rmalloc}(9)
@end iftex
@ifnottex
@inforef{rmalloc(9), , *manpages*}
@end ifnottex
@iftex
@b{rmalloc_wait}(9)
@end iftex
@ifnottex
@inforef{rmalloc_wait(9), , *manpages*}
@end ifnottex
@iftex
@b{rmfree}(9)
@end iftex
@ifnottex
@inforef{rmfree(9), , *manpages*}
@end ifnottex
@iftex
@b{rminit}(9)
@end iftex
@ifnottex
@inforef{rminit(9), , *manpages*}
@end ifnottex
@iftex
@b{rmsetwant}(9)
@end iftex
@ifnottex
@inforef{rmsetwant(9), , *manpages*}
@end ifnottex
@iftex
@b{rmwanted}(9)
@end iftex
@ifnottex
@inforef{rmwanted(9), , *manpages*}
@end ifnottex

Unfortunately, these resource map allocators are not available on
@cite{AIX} so, if portability to the @cite{AIX PSE} is important, then do not
use these allocators.

Additional eligible allocators are:

@iftex
@b{kmem_fast_alloc}(9)
@end iftex
@ifnottex
@inforef{kmem_fast_alloc(9), , *manpages*}
@end ifnottex
@iftex
@b{kmem_fast_free}(9)
@end iftex
@ifnottex
@inforef{kmem_fast_free(9), , *manpages*}
@end ifnottex

@node Alignment of Message Buffers
@subsection Alignment of Message Buffers

@node Disabling and Enabling Queue Procedures
@subsection Disabling and Enabling Queue Procedures

Portable @acronym{STREAMS} modules and drivers will always call
@iftex
@b{qprocson}(9)
@end iftex
@ifnottex
@inforef{qprocson(9), , *manpages*},
@end ifnottex
before returning from its queue open procedure (see
@iftex
@b{qopen}(9)).
@end iftex
@ifnottex
@inforef{qopen(9), , *manpages*}.)
@end ifnottex

Portable @acronym{STREAMS} modules and drivers will always call
@iftex
@b{qprocsoff}(9)
@end iftex
@ifnottex
@inforef{qprocsoff(9), , *manpages*},
@end ifnottex
upon entering its queue close procedure (see
@iftex
@b{qclose}(9)).
@end iftex
@ifnottex
@inforef{qclose(9), , *manpages*}.)
@end ifnottex

@node Freezing and Unfreezing Streams
@subsection Freezing and Unfreezing Streams

@node Passing Messages from Interrupt Service Routines
@subsection Passing Messages from Interrupt Service Routines

@node Timeout Call Back and Link Identifiers
@subsection Timeout Call Back and Link Identifiers

Although buffer callbacks identifiers (see
@iftex
@b{bufcall}(9)),
@end iftex
@ifnottex
@inforef{bufcall(9), , *manpages*}),
@end ifnottex
timeout identifiers (see
@iftex
@b{timeout}(9)),
@end iftex
@ifnottex
@inforef{timeout(9), , *manpages*}),
@end ifnottex
and multiplexing driver link identifiers (see
@var{I_LINK} and @var{I_PLINK} under
@vindex I_LINK
@vindex I_PLINK
@iftex
@b{streamio}(2)),
@end iftex
@ifnottex
@inforef{streamio(2), , *manpages*}),
@end ifnottex
are often illustrated as small integer numbers, with some @acronym{STREAMS}
implementations, including @b{Linux Fast-STREAMS}, these identifiers are kernel
addresses (pointers) and are never small integer values like 1, 2, or 3.

Also, there is no guarantee that the identifier will be positive.  It is
guaranteed that the returned identifier will not be zero (0).  Zero is used by
these function as a return value to indicate an error.

Portable @acronym{STREAMS} drivers and modules will not depend upon the returned
identifier from 
@iftex
@b{bufcall}(9),
@end iftex
@ifnottex
@inforef{bufcall(9), , *manpages*},
@end ifnottex
@iftex
@b{timeout}(9)
@end iftex
@ifnottex
@inforef{timeout(9), , *manpages*}
@end ifnottex
or
@iftex
@b{streamio}(2)
@end iftex
@ifnottex
@inforef{streamio(2), , *manpages*}
@end ifnottex
as being any specific range of value.  Portable drivers and modules will save
any returned identifiers in data types that will not loose the precision of the
identifier.

@node Synchronization with Timeouts and Callback Functions
@subsection Synchronization with Timeouts and Callback Functions

@node Synchronization with Callout Functions
@subsection Synchronization with Callout Functions

@node Synchronization of Drivers and Modules
@subsection Synchronization of Drivers and Modules

@node Special STREAMS Message Types
@subsection Special @acronym{STREAMS} Message Types

@node Use of Message Allocation Priorities
@subsection Use of Message Allocation Priorities

@node Registration/Deregistration and Device Numbering
@subsection Registration/Deregistration and Device Numbering

@subsubheading UNIX Device Numbering

@quotation
In versions of @cite{UNIX System V} previous to @cite{Release 4}, the major and
minor device numbers were each 8 bit, and they were packed into a 16 bit word
(usually a C Language @var{short} variable).  Under @cite{UNIX System V Release
4}, the device numbers are held in a @samp{dev_t}
@tpindex dev_t
variable, which is often
implemented as a 32 bit integer.  The minor device number is held as 14 bits,
and a further 8 bits are used for the major device number.  @samp{dev_t}
@tpindex dev_t
is ofter
referred to as the "expanded device type", since it allows many more minor
devices than before.

Many drivers were written for earlier releases, an may eventually be ported to
@cite{UNIX System V Release 4}.  In earlier releases, some manufacturers got
around the 256 minor device number limit by using multiple major device numbers
for a device.  Devices were created with different major device numbers (the
external major device number) but they all mapped to the same device driver
entry in the device switch tables (the internal device number).  Even under this
scheme, each major device could only support 256 minor devices, but the driver
could support many more.  This has been recognized in @cite{UNIX System V
Release 4}, and functions are provided to do this mapping; for example, the
function @command{etoimajor}() and so on, give a machine independent interface
to the device number mapping.
@footnote{@cite{The Magic Garden Explained}}
@end quotation

@subsubheading Linux Device Numbering

Versions of the @b{Linux} kernel in the 2.4 kernel series and prior to 2.6 also provided an 8 bit
major device number and an 8 bit minor device number grouped into a 16-bit combined device number.
Linux 2.6 and 3.x kernels (and some patched 2.4 kernels) now have larger device numbers.  These
extended device numbers are 12 bits for major device number and 20 bits for minor device number,
with 32 bits for the combined device number.

@subsubheading Linux Fast-STREAMS Device Numbering

@b{Linux Fast-STREAMS} began with extended device numbering.  The @file{specfs}
shadow special character device file system used by @b{Linux Fast-STREAMS} uses
the @samp{inode} number to hold the @samp{dev_t}
@tpindex dev_t
device number instead of the
@samp{inode->i_rdev}, which on older kernels is only a 16-bit @var{short}.

In earlier versions of @b{Linux Fast-STREAMS}, the internal device numbering is
16-bits for major device number and 16-bits for minor device number.  This will
soon be changed to 12-bits for major device number and 20-bits for minor device
number to accommodate the newer @b{Linux} scheme.

On 2.6 and 3.x @b{Linux} kernels that support the newer extended device numbers, external device
numbers and internal device numbers will be the same.  On 2.4 @b{Linux} kernels with the older
16-bit device numbers, external device number and internal device numbers will differ.  In some
situations, an internal device number can exists with no corresponding external device number
(accessed only via a clone device or direct access to the mounted @file{specfs} shadow special
character device file system).

@table @asis

@item @manref{@b{etoimajor}(9)}
change external to internal major device number

@item @manref{@b{getemajor}(9)}
get external major device number

@item @manref{@b{geteminor}(9)}
get external minor device number

@item @manref{@b{itoemajor}(9)}
change internal to external major device number

@end table

@node Licenses
@appendix Licenses
@cindex Licenses

@menu
* GNU General Public License::		The GPL license
* GNU Free Documentation License::	The FDL license
@end menu

@page
@include texi/gpl3.texi

@page
@include texi/fdl13.texi

@page
@node Indices
@unnumbered Indices
@menu
* Concept Index::		Index of Concepts
* Type Index::			Index of Data Types
* Function Index::		Index of Functions and Macros
* Variable Index::		Index of Variables and Constants
* File Index::			Index of Files and Programs
@end menu

@page
@node Concept Index
@unnumberedsec Concept Index
@printindex cp

@page
@node Type Index
@unnumberedsec Type Index
@printindex tp

@page
@node Function Index
@unnumberedsec Function and Macro Index
@printindex fn

@page
@node Variable Index
@unnumberedsec Variable and Constant Macro Index
@printindex vr

@page
@node File Index
@unnumberedsec Program and File Index
@printindex pg

@bye

