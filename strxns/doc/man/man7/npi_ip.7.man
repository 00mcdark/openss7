'\" rtp
.\" -*- nroff -*- vim: ft=nroff nocin nosi
.\"
.\" @(#) $Id: npi_ip.7.man,v 0.9.2.5 2006/04/26 10:45:22 brian Exp $
.\"
.\" =========================================================================
.\"
.\" Copyright (c) 2001-2006  OpenSS7 Corporation <http://www.openss7.com/>
.\"
.\" All Rights Reserved.
.\"
.\" Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\"
.\" Permission is granted to copy and distribute modified versions of this
.\" manual under the conditions for verbatim copying, provided that the
.\" entire resulting derived work is distributed under the terms of a
.\" permission notice identical to this one
.\" 
.\" Since the Linux kernel and libraries are constantly changing, this
.\" manual page may be incorrect or out-of-date.  The author(s) assume no
.\" responsibility for errors or omissions, or for damages resulting from
.\" the use of the information contained herein.  The author(s) may not
.\" have taken the same level of care in the production of this manual,
.\" which is licensed free of charge, as they might when working
.\" professionally.  The author(s) will take no responsibility in it.
.\" 
.\" Formatted or processed versions of this manual, if unaccompanied by
.\" the source, must acknowledge the copyright and authors of this work.
.\"
.\" -------------------------------------------------------------------------
.\"
.\" U.S. GOVERNMENT RESTRICTED RIGHTS.  If you are licensing this Software
.\" on behalf of the U.S. Government ("Government"), the following
.\" provisions apply to you.  If the Software is supplied by the Department
.\" of Defense ("DoD"), it is classified as "Commercial Computer Software"
.\" under paragraph 252.227-7014 of the DoD Supplement to the Federal
.\" Acquisition Regulations ("DFARS") (or any successor regulations) and the
.\" Government is acquiring only the license rights granted herein (the
.\" license rights customarily provided to non-Government users).  If the
.\" Software is supplied to any unit or agency of the Government other than
.\" DoD, it is classified as "Restricted Computer Software" and the
.\" Government's rights in the Software are defined in paragraph 52.227-19
.\" of the Federal Acquisition Regulations ("FAR") (or any successor
.\" regulations) or, in the cases of NASA, in paragraph 18.52.227-86 of the
.\" NASA Supplement to the FAR (or any successor regulations).
.\"
.\" =========================================================================
.\" 
.\" Commercial licensing and support of this software is available from
.\" OpenSS7 Corporation at a fee.  See http://www.openss7.com/
.\" 
.\" =========================================================================
.\"
.\" Last Modified $Date: 2006/04/26 10:45:22 $ by $Author: brian $
.\"
.\" -------------------------------------------------------------------------
.\"
.\" $Log: npi_ip.7.man,v $
.\" Revision 0.9.2.5  2006/04/26 10:45:22  brian
.\" - updated manual pages and references
.\"
.\" Revision 0.9.2.4  2006/04/22 01:07:11  brian
.\" - updating manual pages
.\"
.\" Revision 0.9.2.3  2006/04/05 09:44:55  brian
.\" - moved .so line and updated headers
.\"
.\" =========================================================================
.R1
bracket-label "\fR[\fB" "\fR]" "\fR, \fB"
no-default-database
database strxns.refs
accumulate
move-punctuation
abbreviate A
join-authors ", " ", " " and "
et-al " et al" 2 3
abbreviate-label-ranges ".."
sort-adjacent-labels
.R2
.so strxns.macros
.\"
.\"
.TH NPI-IP 7 "@PACKAGE_DATE@" "@PACKAGE@-@VERSION@" "Network Provider Interface (NPI)"
.\"
.\"
.SH NAME
.B npi_ip
\- Network Provider Interface (NPI) - Internet Protocol (IP) Corrigendum
.\"
.\"
.SH SYNOPSIS
.PP
.B #include <sys/npi.h>
.br
.B #include <sys/npi_ip.h>
.\"
.\"
.SH DESCRIPTION
.PP
.B NPI-IP
provides a Stream supporting the Network Provider Interface,
.[
NPI Revision 2.0.0
.]
.BR npi (7),
to the Internet Protocol,
.BR ip (7).
This
.IR STREAMS (4)
interface provides the
.BR ip (7)
protocol service interface using the N-primitives of the
.BR npi (7).
This interface is intended solely for use by user programs or protocol modules
requiring the common
.BR npi (7)
interface, such as the
.BR xti (3)
and
.BR sockets (3)
library.
.\"
.SS "Address Formats"
.PP
For consistency with other protocol modules, the address format used by
.B NPI-IP
is a Internet Protocol socket address
.RB ( sockaddr_in
structure)
in address family
.B AF_INET
or
.RB ( sockaddr_in6
structure)
in address family
.BR AF_INET6 .
The
.B sockaddr_in
structure is described in
.BR ip (7).
The
.B sockaddr_in6
structure is described in
.BR ipv6 (7).
.PP
.B NPI-IP
supports the notion of multihoming in support of the Stream Control
Transmission Protocol (SCTP)
.[
rfc2960
.]
described in
.BR sctp (7).
SCTP requires that an association be bound to multiple IP or IPv6 addresses.
In support of multihoming,
.B NPI-IP
permits multiple addresses to be specified to bind.  When multiple addresses
are required, they are specified as a special packed list of
.BR sockaddr_in  " or " sockaddr_in6
structures.  The list forms the address specified using the
.IR ADDR_length " and " ADDR_offset
fields in the
.BR N_INFO_ACK (7),
.BR N_BIND_REQ (7)
and
.BR N_BIND_ACK (7)
primitives.
.PP
For IPv4, the format of the address is a
.BR sockaddr_in
structure followed by an array of
.I sin_addr
members.  This is a
.B sockaddr_ina
structure defined as follows:
.PP
.RS
.nf
\fC\s-1\
struct sockaddr_ina {
    unsigned short sin_family;
    unsigned short sin_port;
    struct in_addr sin_addr[];
};
\s+1\fP
.fi
.RE
.\"
.\"
.SS "QOS Parameters"
.PP
.B NPI-IP
provides Quality of Service parameters using
.BR IP -specific
and
.B OSI 
conforming structures as described in the sections that follow.
.HP
.I DESIGN\ NOTES:\-\ \c
This is really problematic trying to map OSI conforming connectionless QOS parameters onto IP QOS
parameters.  What is really needed here is
.BR N_QOS_IP_CL_SEL1
and
.BR N_QOQ_IP_CL_RANGE1
structures.

.\"
.TP
.B N_QOS_CL_SEL1
Used with the
.BR N_INFO_ACK (7)
and
.BR N_OPTMGMT_REQ (7)
primitives, it provides a selection of quality of service parameters for connectionless providers.
.RS
.TP
.I n_qos_type
Always
.B N_QOS_CL_SEL1
indicating the
.B n_qos_cl_sel1
structure.
.TP
.I transit_delay_max
TTL field.
.TP
.I residual_error_rate
TOS type of service.
.TP
.I protection_sel
Provides the protection selection.  Values can be one of:
.BR N_NO_PROT ,
no protection;
.BR N_PASSIVE_PROT ,
protection against passive monitoring;
.BR N_ACTIVE_PROT ,
protection against active monitoring; and,
.BR N_ACTIVE_PASSIVE_PROT ,
protection against active and passive monitoring.
The
.B NPI-IP
provider only need support
.BR N_NO_PROT .
.TP
.I priority_sel
Provideds selection of the priority of a given packet or packets within an association.  Under
.B NPI-IP
this is the
.I TOS Precedence
and can have values:
.BR N_ROUTINE ,
.BR N_PRIORITY ,
.BR N_IMMEDIATE ,
.BR N_FLASH ,
.BR N_OVERRIDEFLASH ,
.BR N_CRITIC_ECP ,
.BR N_INETCONTROL ,
and
.BR N_NETCONTROL .
.TP
.I max_accept_cost
.RE
.\"
.TP
.B N_QOS_CL_RANGE1
Used with the
.BR N_INFO_ACK (7)
primitive, it provides a range of quality of service parameters for connectionless providers.
.RS
.TP
.I n_qos_type
Always
.B N_QOS_CL_RANGE1
indicating the
.B n_qos_cl_range1
structure.
.TP
.I transit_delay_max
.RS
.TP
.I td_targ_value
.TP
.I td_max_value
.RE
.TP
.I residual_error_rate
.TP
.I protection_range
.RS
.TP
.I protect_targ_value
.TP
.I protect_min_value
.RE
.TP
.I priority_range
.RS
.TP
.I priority_targ_value
.TP
.I priority_min_value
.RE
.TP
.I max_accept_cost
.RE
.\"
.\"
.SS "Local Management Interface"
.PP
For the most part, the local management interface of the NPI operates for the
NPI-IP provider in accordance with the Network Provider Interface Revision
2.0.0 specifications.
.[
NPI Revision 2.0.0
.]
Some enhancements are provided to addressing in support of the Stream Control
Transmission Protocol (SCTP)
.[
rfc2960
.]
and multihomed associations.
.PP
The local management primitives are interpreted and issued as
follows:
.TP
.BR N_INFO_REQ (7)
This primitive is interpreted by the NPI-IP provider in accordance with the
NPI specifications.
.[
NPI Revision 2.0.0
.]
.TP
.BR N_INFO_ACK (7)
This primitive is issued by the NPI-IP provider in accordances with the NPI
specifications
.[
NPI Revision 2.0.0
.]
with the following considerations:
.RS
.TP
.I NSDU_size
This field reflects the current Maximum Transfer Unit (MTU) (minus the size of
the IP header), times the number of IP packets that can be generated
considering IP fragmentation, for the Stream given the protocol addresses to
which the Stream is bound.
.TP
.I ENSDU_size
The NPI-IP provider, being a CLNS provider, has no concept of expedited data
and this field is always set to zero
.RB ( 0 ).
.TP
.I CDATA_size
The NPI-IP provider, being a CLNS proivder, has no concept of connection data
and this field is always set to zero
.RB ( 0 ).
.TP
.I DDATA_size
The NPI-IP provider, being a CLNS proivder, has no concept of connection data
and this field is always set to zero
.RB ( 0 ).
.TP
.I ADDR_size
Specifies the maximum address size.  For a device that supports IPv4, this is
the size of the
.B sockaddr_in
structure.  For an NPI-IP provider supporting multihoming, this value will
be an integer multiple of the size of the
.B sockaddr_in
structure.  For a device that supports IPv6, the size of the
.B sockaddr_in6
structure, or, supprorting multihoming, an integer multiple.
.TP
.IR ADDR_length ", " ADDR_offset
The length and offset from the beginning of the message block of the bound protocol addresses.  For an NPI-IP provider
supporting multihoming, the length and offset specify a list of address
structures as described above under
.RB \*(lq "Address Formats" \*(rq.
.TP
.IR QOS_length ", " QOS_offset
The length and offset from the beginning of the message block of the current selected QOS parameters.  This will be an
.B N_QOS_CL_SEL1
structure completed as described above under
.RB \*(lq "QOS Parameters" .\*(rq
It may be necessary to bind a Stream before a value will be returned in the
information acknowledgement.
.TP
.IR QOS_range_length ", " QOS_range_offset
The length and offset from the beginning of the message block of the current range of QOS parameters.  This will be an
.B N_QOS_CL_RANGE1
structure completed as described above under
.RB \*(lq "QOS Parameters" .\*(rq
It may be necessary to bind a Stream before a value will be returned in the
information acknowledgement.
.TP
.I OPTIONS_flags
The NPI-IP provider sets no options flags and this field is always set to zero
.RB ( 0 ).
.TP
.I NIDU_size
The NPI-IP provider, being a CLNS proivder, has no concept of interface data
unit size
and this field is always set to zero
.RB ( 0 ).
.TP
.I SERV_type
The NPI-IP provider always sets this field to
.B N_CLNS
for connectionless network service.
.TP
.I CURRENT_state
Indicates the current state of the NPI provider in accordance with the NPI
specifications.
.TP
.I PROVIDER_type
The NPI-IP proivder always sets this field to
.B N_SNICFP
for Subnetwork Independent Convergence Function/Protocol.
.TP
.I NODU_size
This field reflects the current Maximum Transfer Unit (MTU) (minus the size of
the IP header) for the Stream given the protocol address to which the Stream
is bound.  Sending a packet using the
.BR N_UNITDATA_REQ
primitive with a data payload of less than or equal to this size will not
normally result in IP fragmentation.
.TP
.IR PROTOID_length ", " PROTOID_offset
The length and offset from the beginning of the message block of the bound protocol identifiers.
.TP
.I NPI_version
The NPI-IP always sets this field to
.B N_VERSION_2
to indicat Network Provider Interface Revision 2.0.0.
.[
NPI Revision 2.0.0
.]
.RE
.TP
.BR N_OPTMGMT_REQ (7)
.RS
.TP
.IR QOS_length ", " QOS_offset
The length and offset from the beginning of the message block of the protocol
options.
The NPI-IP provider will only recognize the
.B N_QOS_CL_SEL1
structure type and will return
.BR NBADQOSTYPE
for all other structures.
.TP
.I OPTMGMT_flags
The NPI-IP provider does not support receipt acknowledgement and will ignore
the
.B DEFAULT_RC_SEL
flag because it is a CLNS provider as specified in the NPI.
.[
NPI Revision 2.0.0
.]
.RE
.TP
.BR N_BIND_REQ (7)
.RS
.TP
.I PRIM_type
.TP
.IR ADDR_length ", " ADDR_offset
Specifies the length in bytes of the network addresses to be bound to the
Stream and the offset from the beginning of the
.BR M_PROTO (9)
message block where the network addresses begin.
Typically in NPI the network address consists of a single address.  In support
of the Stream Control Transmission Protocol (SCTP), the
.B NPI-IP
driver supports the specification of multiple addresses in the form of a
list of addresses.  See
.RB \*(lq "ADDRESS FORMAT" ,\*(rq
above.
.TP
.I CONIND_number
This number is ignored in CLNS in accordance with the NPI specification.
.TP
.I BIND_flags
.RS
.TP
.B DEFAULT_LISTENER
This flag is ignored in CLNS in accordance with the NPI specification.
.TP
.B TOKEN_REQUEST
This flag is ignored in CLNS in accordance with the NPI specification.
.TP
.B DEFAULT_DEST
This flag is honored by NPI-IP.  When set, this flag indicates that this
Stream is the \*(lqdefault destination Stream.\*(rq  This Stream will receive
all packets destined for the NSAP specified in the bind request.  If no NSAP
is specified in the bind request, then this Stream should receive all packets
destined to an NSAP which is bound to no other Stream.  Only one default
destination Stream per NSAP is allowed per occurrence of NPI.  An attempt to
bind a default destination Stream to an NSAP when one is already bound should
result in an error of type
.BR NBOUND .
.RE
.TP
.IR PROTOID_length ", " PROTOID_offset
Specifies the length in bytes of the protocol ids and the offset from the
beginning of the
.BR M_PROTO (9)
message block where the protocol ids begin.  Protocol ids for NPI-IP consist
of IP protocol numbers.  Typically only one IP protocol number is bound in a
given bind request.
.RE
.TP
.BR N_BIND_ACK (7)
The bind acknowledgement primitive is issued in accordance with the NPI
specifications.  When a multihomed address was specified to the bind, the
.IR ADDR_length " and " ADDR_offset
fields may specify a bound address that consists of a list of addresses as
indicated under
.RB \*(lq "ADDRESS FORMATS" ,\*(rq
above.
.RS
.PP
If no address was specified to the bind, the NPI-IP provider will assume that
all local addresses are to be bound.  The NPI-IP provider also respects the
.B INADDR_ANY
value in the address, as well as the special port number zero (0).
.RE
.TP
.BR N_UNBIND_REQ (7)
The unbind request primitive is interpreted by the NPI-IP provider in
accordance with the NPI specifications.  If the user specified multiple
addresses to the bind request, the unbind request is interpreted as unbinding
all bound addresses.
.TP
.BR N_OK_ACK (7)
The NPI-IP provider issues this primitive in accordance with the NPI
specifications.
.[
NPI Revision 2.0.0
.]
.TP
.BR N_ERROR_ACK (7)
The NPI-IP provider issues this primitive in accordance with the NPI
specifications.
.[
NPI Revision 2.0.0
.]
.\"
.\"
.SS "Connectionless Data Transfer"
.PP
The NPI-IP provider is a CLNS (Connectionless Network Service) provider that
uses the connectionless data transfer N-primitives to transfer data.  For the
most part, these primitives are used in strict accordance with the NPI
specifications.
.[
NPI Revision 2.0.0
.]
Some enhancements are provided to addressing in support of the Stream Control
Transmission Protocol (SCTP)
.[
rfc2960
.]
and multihomed associations.
.PP
The connectionless data transfer primitives are interpreted and issued as
follows:
.TP
.BR N_UNITDATA_REQ (7)
This primitive is interpreted by the NPI-IP provider as specified in the NPI specification.
.[
NPI Revision 2.0.0
.]
.RS
.TP
.IR DEST_length ", " DEST_offset
These fields are interpreted as the destination address for the IP packet.
The specified address must be a single address and cannot contain a list.
.TP
.IR RESERVED_Field "[0] and " RESERVED_field [1]
These fields are reserved for DLPI
.[
DLPI
.]
compatibility and are normally set to zero.  For multihomed hosts in support
of the Stream Control Transmission Protocol (SCTP),
.[
rfc2960
.]
and when the Stream is bound to multiple addresses, these fields can be
treated as
.IR SRC_length ", " SRC_offset
fields and used to specify the source address for the outgoing packet.
The source address specified must normally be one of the addresses to which the
Stream is bound.  If not, the NPI-IP provider may return the
.B NBADADDR
error in a
.BR N_UDERROR_IND (7)
primitive.
If a source address is not specified (i.e.
.I SRC_length
is zero), then the NPI-IP provider will select a source address from those to
which the Stream was bound.
If only one address was bound, these fields are ignored and the NPI-IP provider
will use the bound address as the source address for the packet.
.PP
In addition to the normal use of the
.BR N_UNITDATA_REQ (7)
primitive, the primitive can be used to return a message delivered to the
NPI-IP NS User with the
.BR N_UNITDATA_IND (7)
primitive.  This is accomplished by simply changing the
.I PRIM_type
from
.B N_UNITDATA_IND
to
.B N_UNITDATA_REQ
and passing the message back downstream.  The NPI-IP NS Provider will detect
that the destination address is one of the addresses bound to the Stream and
will pass the message to any other Linux IP user registered against the
protocol ID, if there is no other Linux IP user registered against the
protocol ID, these messages are simply discarded.
.RE
.TP
.BR N_UNITDATA_IND (7)
This primitive is issued by the NPI-IP provider in accordance with the NPI
specification.
.[
NPI Revision 2.0.0
.]
.RS
.TP
.IR DEST_length ", " DEST_offset
It is normally only necessary for the NPI provider to specify the destination
address if it is not implicit to the receiving Stream: that is, if the
receiving Stream is a default destination Stream.  For NPI-IP, it is also
necessary that the destination address be specified by the NPI-IP provider
when the receiving Stream is bound to more than one address.  These fields
specify a single address.
.TP
.IR SRC_length ", " SRC_offset
Populated by the NPI provider in accordance with the NPI specifications.
These fields specify a single address.
.TP
.IR ERROR_type
Populated by the NPI provider in accordance with the NPI specifications.  The
NPI-IP provider may indicate the
.B N_UD_CONGESTION
value in this field when the IP packet is marked for Explicit Congestion
Notification or other congestion indication.
.PP
Note that addresses, IP options and other IP particulars are available in the
message block.  The message body (attached
.BR M_DATA (9)
message blocks) contains the entire IP packet including IP network and
transport headers and payload.
.RE
.TP
.BR N_UDERROR_IND (7)
This primitive is issued by the NPI-IP provider in accordance with the NPI
specification.
.[
NPI Revision 2.0.0
.]
.RS
.TP
.IR DEST_length ", " DEST_offset
Populated by the NPI-IP provider in accordance with the NPI specifications.
.[
NPI Revision 2.0.0
.]
.TP
.I RESERVED_field
This field is set to zero (0) in accordance with NPI specifications.
.[
NPI Revision 2.0.0
.]
.\".TP
.\".IR RESERVED_field "[0] and " RESERVED_field [1]
.\"As with the
.\".BR N_UNITDATA_REQ (7)
.\"primitive, these fields are reserved fro DLPI
.\".[
.\"DLPI
.\".]
.\"compatibility and are normally set to zero.  For multihomed hosts in support
.\"of the Stream Control Transmission Protocol (SCTP),
.\".[
.\"rfc2960
.\".]
.\"and when the Stream is bound to multiple addresses, these fields can be
.\"treated as
.\".IR SRC_length ", " SRC_offset
.\"fields and used to specify the source address for the outgoing packet that was
.\"in error.  The source address indicated will be one of the addresses to which
.\"the Stream is bound.
.\"If only one address was bound, these fields are set to zero by the NPI-IP
.\"proivder.
.TP
.I ERROR_type
This field is populated by the NPI-IP provider in accordance with the NPI
specifications.  Some of the
.BR N_UDERROR_IND (7)
reason codes have additional meaning when issued by the NPI-IP provider as
follows:
.RS
.TP
.B N_UD_UNDEFINED
No reason was specified.
.TP
.B N_UD_TD_EXCEEDED
Transit delay exceeded.
This can be generated by the NPI-IP provider in response to an ICMP message
.RB ( ICMP_TIME_EXCEEDED/ICMP_EXC_FRAGTIME ).
.TP
.B N_UD_CONGESTION
NS Provider congestion encountered.
This can be generated by the NPI-IP provider in response to an ICMP message
.RB ( ICMP_SOURCE_QUENCH ).
.TP
.B N_UD_QOS_UNAVAIL
Requested QOS/service characteristic unavailable.
.TP
.B N_UD_LIFE_EXCEEDED
NSDU lifetime exceeded.  This is an indication that the specified lifeimte
(TTL) was exceeded as detected to the NPI-IP provider in a returned ICMP
message.
This can be generated by the NPI-IP provider in response to an ICMP message
.RB ( ICMP_TIME_EXCEEDED/ICMP_EXC_TTL ).
.TP
.B N_UD_ROUTE_UNAVAIL
Suitable route unavailable.  This is used by the NPI-IP provider to specify
many separate error conditions as indicated by the received ICMP messages.
This can be generated by the NPI-IP provider in response to an ICMP message
.RB ( ICMP_DEST_UNREACH/ICMP_PROT_UNREACH ", " ICMP_PORT_UNREACH ", "
.BR ICMP_NET_UNKNOWN ", " ICMP_HOST_UNKNOWN ", " ICMP_HOST_ISOLATED ", "
.BR ICMP_NET_ANO ", " ICMP_HOST_ANO ", " ICMP_PKG_FILTERED ", "
.BR ICMP_PREC_VIOLATION ", " ICMP_PREC_CUTOFF ).
.TP
.B N_UD_SEG_REQUIRED
Segmentation was required where none permitted.  This error is used in
conjunction the Path MTU Discovery and is used ot indicate that a packet that
was marked don't fragment encounter a path with an MTU less than the packet
size.
This can be generated by the NPI-IP provider in response to an ICMP message
.RB ( ICMP_DEST_UNREACH/ICMP_FRAG_NEEDED ).
.RE
.PP
Note that the source address, IP options and ICMP particulars are available in
the message body.  The message body (attached
.BR M_DATA (9)
message blocks) contains the entire IP packet including IP and ICMP headers
and payload.
.RE
.\"
.\"
.SS Connection-Oriented Connection Establishment
.PP
The NPI-IP provider also provides a pseudo-CONS (Connection Oriented Network
Service) provider that uses the connection mode data transfer N-primitives to
transfer data.  For the most part, these primitives are used in accordance
with the NPI specifications.
.[
NPI Revision 2.0.0
.]
Some enhancements are provided to addressing in support of the multi-homed
nature of the Stream Control Transmission Protocol (SCTP).
.[
rfc2960
.]
.PP
The connection establishment primitives are interpreted as follows:
.TP
.BR N_CONN_REQ (7)
This primitive is interpreted by the NPI-IP provider in accordances with the
NPI specification,
.[
NPI Revision 2.0.0
.]
.BR npi (7),
with the following considerations:
.RS
.IP 1. \w'0.\(em'u
The primitive can be issued on a Stream that has not yet been bound; i.e. that
is in the
.I NS_UNBND
state.  The
.B NPI-IP
provider will autobind the Stream to an IP addres of
.BR INADDR_ANY ,
a dynamically assigned port number, and the UDP protocol number.  The
resulting Stream will be a pseudo-connection-oriented mode Stream.  This is
primarily for compatibility with the
.BR sockets (3)
library.  The NPI specificiation,
.[
NPI Revision 2.0.0
.]
.BR npi (7),
indicates that the response in this situation should be a
.BR N_ERROR_ACK (7)
primitive with either a
.RB [ NNOTSUPPORT ]
or
.RB [ NOUTSTATE ]
error.
.IP 2.
The primitive can be issued on a Stream that has been bound, but which reports
a
.I SERV_type
of
.B N_CLNS
in the
.BR T_INFO_ACK (7)
primitive.  This, again, is primarily for compatibility with the
.BR sockets (3)
library.  The NPI specification,
.[
NPI Revision 2.0.0
.]
.BR npi (7),
indicates that the response in this situation should be a
.BR N_ERROR_ACK (7)
primitive with a
.RB [ NNOTSUPPORT ]
error.
.TP
.IR DEST_length ", " DEST_offset
The length and offset from the beginning of the
.BR M_PROTO (9)
message block of the memory extent containing the destination address(es), to
which the connection is to be formed.
This field can contain more than one IP address, but can only contain one port
number.
.TP
.IR CONN_flags
Specifies connection options flags associated with the connection request.
The folowing connection flags are defined, but not supported:
.RS
.TP
.B REC_CONF_OPT
Specifies that receipt confirmation is to be used by default.  The
.B NPI-IP
provider does not support receipt confirmation and setting this flag is
invalid.
.TP
.B EX_DATA_OPT
Specifies that expedited data transfer is to be enabled by default.  The
.B NPI-IP
provider does not support expedited data transfer and setting this flag is
invalid.
.RE
.TP
.IR QOS_length ", " QOS_offset
The length and offset from the beginning of the
.BR M_PROTO (9)
message block of the memory extent containing the quality-of-service parameters
to be associated with the connection.  See
.RI \(lq "Quality of Service" ,\(rq
above.  The only QOS data type accepted in the
.BR N_CONN_REQ (7)
by the
.B NPI-IP
provider is the
.BR N_QOS_SEL_CONN_IP
data structure containing the following fields:
.RS
.TP
.I n_qos_type
Always
.BR N_QOS_SEL_CONN_IP .
.TP
.I protocol
Specifies the protocol field used for packets sent on the network connection.
.TP
.I priority
Specifies the priority of packets sent on the network connection.
.TP
.I ttl
Specifies the time-to-live field used for packets sent on the network connection.
.TP
.I tos
Specifies the type-of-service field used for packets sent on the network connection.
.TP
.I mtu
Specifies the maximum-transfer-unit to be used for packets sent on the network connection.  If the
MTU of the path upon which IP packets are sent is less than this value, the lower MTU will be used.
If the MTU of the path on which IP packets are sent is greater than this value, the lower MTU will
be used.
.RE
.RE
.TP
.BR N_CONN_IND (7)
This primitive is issued by the NPI-IP provider in accordances with the
NPI specification,
.[
NPI Revision 2.0.0
.]
.BR npi (7),
with the following considerations:
.RS
.IP 1. \w'0.\(em'u
The
.B NPI-IP
provider does not provide true connection-oriented modes.  In pseudo-connection-oriented mode, with
a listening Stream, connection indications are synthesized from any received packet that matches the
listening Stream and delivered as a connection indication (with data).
.TP
.IR DEST_length ", " DEST_offset
The length and offset from the beginning of the
.BR M_PROTO (9)
message block of the memory extent containing the destination address of the
IP packet causing the connection indication.  This field will contain only one
destination address and is structured as a
.BR sockaddr_in
structure.
.TP
.IR SRC_length ", " SRC_offset
The length and offset from the beginning of the
.BR M_PROTO (9)
message block of the memory extent containing the source address of the IP
packet causing the connection indication.  This field will contain only one
source address and is structured as a
.BR sockaddr_in
structure.
.TP
.IR SEQ_number
Indicates the sequence number for the connection indication to be used by the NS user in a
subsequent
.BR N_DISCON_REQ (7)
or
.BR N_CONN_RES (7)
primitive.
.TP
.IR CONN_flags
Indicates the connection options flags associated with the connection request.  The following
connection flags are defined, but not supported:
.RS
.TP
.B REC_CONF_OPT
Indicates that receipt confirmation is requested to be used on the connection by default.  The
.B NPI-IP
provider does not support receipt confirmation and this flag will not be indicated.
.TP
.B EX_DATA_OPT
Indicates that expedited data transfer is requested to be enabled by default.  The
.B NPI-IP
provider does not suport expedited data transfer and this flag will not be indicated.
.RE
.TP
.IR QOS_length ", " QOS_offset
The length and offset from the beginning of the
.BR M_PROTO (9)
message block of the memory extent containing the quality-of-service parameters associated with the
connection indication.  See
.RI \(lq "Quality of Service" ,\(rq
above.  The only QOS data type indicated in the
.BR N_CONN_IND (7)
primitive by the
.B NPI-IP
provider is the
.B N_QOS_SEL_CONN_IP
data structure containing the following information:
.RS
.TP
.I n_qos_type
Always
.BR N_QOS_SEL_CONN_IP .
.TP
.I protocol
Indicates the protocol of the received packet that invoked the connection indication.
.TP
.I priority
Indicates the priority of the received packet that invoked the connection indication.
.TP
.I ttl
Indicates the time-to-live field received in the packet that invoked the connection indication.
.TP
.I tos
Indicates the type-of-service field received in the packet that invoked the connection indicaiton.
.TP
.I mtu
Indicates the maximum-transfer-unit to be used for packets sent on the network connection
toward the source address of the received packet that invoked the connection indiciation.
.RE
.RE
.TP
.BR N_CONN_RES (7)
This primitive is interpreted by the NPI-IP provider in accordances with the
NPI specification,
.[
NPI Revision 2.0.0
.]
.BR npi (7),
with the following considerations:
.RS
.IP 1. \w'0.\(em'u
The
.B NPI-IP
provider does nto support true connection-oriented modes; only a pseud-connection-oriented mode.
Accepting a connection indication with this primitive will deliver queued and any further received
packets with the same source and destination addresses, port numbers and protocol number to the
accepting Stream.
.IP 2.
Default quality-of-service parameters associated with the Stream are not negotiated end-to-end and
are simply set as specified.
.IP 3.
The responding address(es) do no represent the local addresses that form the connection, but the
remote addresses involved in a multi-homed association.
.TP
.IR TOKEN_value
Specifies the token value of the Stream onto which the connection is to be accepted.  If the
connection is to be accepted on the same Stream upon which the corresponding
.BR N_CONN_IND (7)
was received, this field should be zero (0).  It is an error to accept a connection on the listening
Stream if there is more than one connection indication outstanding.
.TP
.IR RES_length ", " RES_offset
The length and offset from the beginning of the
.BR M_PROTO (9)
message block of the memory extent containing the responding address(es).
.TP
.IR SEQ_number
Specifies the sequence number in the corresponding
.BR N_CONN_IND (7)
primitive to which this primitive is responding.
.TP
.IR CONN_flags
Specifies connection options flags for the resulting NS connection.  The following flags are
defined; but not supported:
.RS
.TP
.B REC_CONF_OPT
Specifies that receipt confirmation is to be used by default.  The
.B NPI-IP
provider does not support receipt confirmation and setting this flag is
invalid.
.TP
.B EX_DATA_OPT
Specifies that expedited data transfer is to be enabled by default.  The
.B NPI-IP
provider does not support expedited data transfer and setting this flag is
invalid.
.RE
.TP
.IR QOS_length ", " QOS_offset
The length and offset from the beginning of the
.BR M_PROTO (9)
message block of the memory extent containing the quality-of-service parameters to be used with the
completed NS connection.  See
.RI \(lq "Quality of Service" ,\(rq
above.
The only QOS data type allowed in the 
.BR N_CONN_RES (7)
primitive by the
.B NPI-IP
provider is the
.B N_QOS_SEL_CONN_IP
data structure containing the following information:
.RS
.TP
.I n_qos_type
Always
.BR N_QOS_SEL_CONN_IP .
.TP
.I protocol
Specifies the protocol to be used for packets sent on the network connection.
.TP
.I priority
Specifies the priority to be used for packets sent on the network connection.
.TP
.I ttl
Specifies the time-to-live field to be used in packets sent on the network connection.
.TP
.I tos
Specifies the type-of-service field to be used in packets sent on the network connection.
.TP
.I mtu
Specifies the maximum-transfer-unit to be used for packets sent on the network connection.
If the underlying maximum-transfer-unit is different from this value, the smaller of the two will be
used.
.RE
.RE
.TP
.BR N_CONN_CON (7)
This primitive is issued by the NPI-IP provider in accordances with the
NPI specification,
.[
NPI Revision 2.0.0
.]
.BR npi (7),
with the following considerations:
.RS
.IP 1. \w'0.\(em'u
The
.B NPI-IP
provider does not provide true confirmation of a connection in pseudo-connection-oriented mode.  The
confirmation is issued automatically and locally by the
.B NPI-IP
provider upon receipt of a proper
.BR N_CONN_REQ (7)
primitive.
.IP 2.
Quality of service values confirmed are the result of negotiation with the local provider only and
are not the result of end-to-end negotiation in pseudo-connection-oriented mode.
.TP
.IR RES_length ", " RES_offset
The length and offset from the beginning of the
.BR M_PROTO (9)
message block of the memory extent containing the responding address(es), which, in the case of the
.B NPI-IP
provider in pseudo-connection-oriented mode, is the same as the requested destination address(es).
.TP
.IR CONN_flags
Indicates the connection options flags associated with the connection cofirmation.  The following
flags are defined; but not supported:
.RS
.TP
.B REC_CONF_OPT
Indicates that receipt confirmation is requested to be used on the connection by default.  The
.B NPI-IP
provider does not support receipt confirmation and this flag will not be indicated.
.TP
.B EX_DATA_OPT
Indicates that expedited data transfer is requested to be enabled by default.  The
.B NPI-IP
provider does not suport expedited data transfer and this flag will not be indicated.
.RE
.TP
.IR QOS_length ", " QOS_offset
The length and offset from the beginning of the
.BR M_PROTO (9)
message block of the memory extent containing the quality-of-service parameters associated with the
confirmed connection.  The values represent negotiation with the local provider only, and are not
the result of end-to-end negotiation.  See
.RI \(lq "Quality of Service" ,\(rq
above.  The only QOS data type indicated in the
.BR N_CONN_CON (7)
primitive by the
.B NPI-IP
provider is the
.B N_QOS_SEL_CONN_IP
data structure containing the following information:
.RS
.TP
.I n_qos_type
Always
.BR N_QOS_SEL_CONN_IP .
.TP
.I protocol
Confirms the protocol value to be used in outgoing packets on the network connection.
.TP
.I priority
Confirms the priority value to be used in outgoing packets on the network connection.
.TP
.I ttl
Confirms the time-to-live value to be used in outgoing packets on the network connection.
.TP
.I tos
Confirms the type-of-service value to be used in outgoing packets on the network connection.
.TP
.I mtu
Confirms the maximum-transfer-unit to be used for outgoing packets on the network connection.  This
is the minimum of the individual maximum-transfer-units of all the destinations for the network
connection and the requested maximum-transfer-unit.
.RE
.RE
.\"
.\"
.SS Connection-Oriented Data Transfer
.PP
.TP
.BR N_DATA_REQ (7)
In pseudo-connection-oriented mode, the NPI-IP user transfers data using the
.BR N_DATA_REQ (7)
primitive.  When the destination host is multi-homed, the data will be sent to
the primary destination address.  The current primary destination address can
be changed with the
.BR N_OPTMGMT_REQ (7)
primitive.  The source address on the IP packet will be one of the addresses
associated with the route and the outgoing interface.
.IP ""
Fields of the primitive are interpreted as follows:
.RS
.TP
.I DATA_xfer_flags
.RS
.TP
.B N_MORE_DATA_FLAG
This flag may be set in accordance with the NPI specifications; however, as the
.B NPI-IP
provider performs segmentation and reassembly at the
.B IP
level, this flag is unused.  Setting this flag will result in a fatal
.RB [ EPROTO ]
error condition.
.TP
.B N_RC_FLAG
This flag may be set in accordance with the NPI specifications; however, as
the
.B NPI-IP
provider does not support receipt verification, this flag is unused.  Setting
this flag will result in a fatal
.RB [ EPROTO ]
error condition.
.RE
.RE
.TP
.BR N_DATA_IND (7)
In pseudo-connection-oriented mode, the NPI-IP provider transfers data to the
NPI-IP user with the
.BR N_DATA_IND (7)
primitive.  For multihomed local or remote hosts, information concerning the
source address and destination address of the packet is lost.  For a service
that provides this information, use the connectionless mode.
.IP ""
Fields of the primitive are interpreted as follows:
.RS
.TP
.I DATA_xfer_flags
.RS
.TP
.B N_MORE_DATA_FLAG
This flag is populated by the NPI-IP provider in accordance with the NPI
specifications; however, because the
.B NPI-IP
provider performs segmentation and reassembly at the
.B IP
level, this flag is unused and is never set by the NPI-IP provider.
.TP
.B N_RC_FLAG
This flag is populated by the NPI-IP provider in accordance with the NPI
specifications; however, because the
.B NPI-IP
provider does not support receipt verification, this flag is unused and is
never set by the NPI-IP provider.
.RE
.RE
.TP
.BR N_DATACK_REQ "(7), " N_DATACK_IND (7)
The
.B NPI-IP
provider does not support receipt confirmation because it is not provided by
the underlying
.B IP
protocol.
.TP
.BR N_RESET_REQ "(7), " N_RESET_IND "(7), " N_RESET_RES "(7), " N_RESET_CON (7)
The
.B NPI-IP
provider does not support connection reset because it is not provided by the
underlying
.B IP
protocol.
.TP
.I RESET_orig
.RS
.TP
.B N_PROVIDER
.TP
.B N_USER
.TP
.B N_UNDEFINED
.RE
.TP
.I RESET_reason
.RS
.PP
When
.I RESET_orig
is
.BR N_PROVIDER ,
the following reasons apply:
.RS
.TP
.B N_CONGESTION
.TP
.B N_RESET_UNSPECIFIED
.RE
.PP
When
.I RESET_orig
is
.BR N_USER ,
the following reasons apply:
.RS
.TP
.B N_USER_RESYNC
.RE
.PP
When
.I RESET_orig
is
.BR N_UNDEFINED ,
the following reasons apply:
.RS
.TP
.B N_REASON_UNDEFINED
.RE
.RE
.\"
.\"
.SS Connection-Oriented Connection Termination
.PP
.TP
.BR N_DISCON_REQ (7)
Disconnect requests result in the abortive relase of the psuedo-connection.
The primitive is acknowledge in accordance with NPI specifications.
.RS
.TP
.IR DISCON_reason
.TP
.IR RES_length ", " RES_offset
The length and offset from the beginning of the
.BR M_PROTO (9)
message block of the memory extent containing the responding address(es).
.TP
.IR SEQ_number
.RE
.TP
.BR N_DISCON_IND (7)
Because the NPI-IP provider is only a pseudo-connection-oriented provider,
disconnect indications are not issued by the provider.
.TP
.I DISCON_orig
.RS
.TP
.B N_PROVIDER
.TP
.B N_USER
.TP
.B N_UNDEFINED
.RE
.TP
.I DISCON_reason
.RS
.PP
When the
.I DISCON_orig
is
.BR N_PROVIDER ,
the following reasons apply:
.RS
.TP
.B N_DISC_P
.TP
.B N_DISC_T
.TP
.B N_REJ_NSAP_UNKNOWN
.TP
.B N_REJ_NSAP_UNREACH_P
.TP
.B N_REJ_NSAP_UNREACH_T
.TP
.B N_REJ_QOS_UNAVAIL_P
.TP
.B N_REJ_QOS_UNAVAIL_T
.TP
.B N_REJ_UNSPECIFIED
.RE
.PP
When the
.I DISCON_orig
is
.BR N_USER ,
the following reasons apply:
.RS
.TP
.B N_DISC_NORMAL
.TP
.B N_DISC_ABNORMAL
.TP
.B N_REJ_P
.TP
.B N_REJ_T
.TP
.B N_REJ_INCOMPAT_INFO
.TP
.B N_REJ_QOS_UNAVAIL_P
.TP
.B N_REJ_QOS_UNAVAIL_T
.TP
.B N_REJ_UNSPECIFIED
.RE
.PP
When the
.I DISCON_orig
is
.BR N_UNDEFINED ,
the following reasons apply:
.RS
.TP
.B N_REASON_UNDEFINED
.RE
.RE
.\"
.\"
.SH IOCTLS
.PP
The
.B NPI
specification
.[
NPI Revision 2.0.0
.]
does not standardize on any input-output controls.

.\"
.\"
.\".SH "ERROR HANDLING"
.\".PP
.\"
.\"
.\".SH ERRORS
.\".PP
.\"
.\"
.SH NOTICES
.PP
There are a number of purposes for this NPI-IP driver:
.IP 1. \w'0.\(em'u
The
.I OpenSS7 Project
has a need for a solution for providing a pseudo-device driver for RTP (Real-Time Transport
Protocol).
.[
rfc1889
.]
Because RTP runs over UDP (User Datagram Protocol), it is necessary to intercept packets
ahead of Linux' native UDP at the IP level to avoid the inefficiencies of opening Sockets from
inside the kernel.  This NPI-IP driver accomplishes that feat.  It also permits a single Stream to
be opened but which communicates on many RTP channels.
.IP 2.
The
.I OpenSS7 Project
has a need for a direct interface and interception (drop and insert) capabilities at the IP level
for the purposes of testing both RTP (Real-Time Transport Protocol)
.[
rfc1889
.]
and SCTP (Stream Control Transmission Protocol).
.[
rfc2960
.]
This need is less critical because of the availability of Ferry-Clip
testing, using STREAMS-based pipes, that can be rigged to RTP and SCTP to acheive the same effect.
.IP 3.
Although historically the STREAMS SCTP driver hooks directly to the Linux native IP subsystem at the
driver-kernel level, it might be of some advantage to make SCTP a pushable module that simply pushes
over one of these NPI-IP Streams, or a multiplexing driver under which one of these NPI-IP Streams
is permanently linked at system initialization.  The ability to bind multiple addresses is of use to
SCTP.
.IP 4.
Although there is no prevailing standardized way of interfacing to the IP layer of various
.IR UNIX \(rg
operating systems, such as
.IR Solaris \(rg,
.[
soldoc
.]
it might be possible to make the
.I OpenSS7 Project
RTP and SCTP drivers immediately portable to other operating systems with STREAMS such as
.IR Solaris \(rg,
.IR pSOS \(rg,
.IR vxWorks \(rg,
.IR LynxOS \(rg,
etc. by simply porting the NPI-IP driver instead of each protocol driver.
.\"
.\"
.SH "SEE ALSO"
.PP
.BR npi (7),
.BR getpmsg (2s),
.BR putpmsg (2s),
.BR getpmsg (3p),
.BR putpmsg (3p),
.BR ioctl (2),
.BR ioctl (3p).
.\"
.\"
.SH VERSIONS
.PP
This is version @VERSION@ of the NPI-IP Corrigendum.
.\"
.\"
.SH COMPATIBILITY
.PP
There is, in fact, no standard for using the Network Provider Interface (NPI)
.[
NPI Revision 2.0.0
.]
with the Internet Protocol (IP) suite.  Although historically some approaches may have been taken in
various releases of the
.IR UNIX \(rg
operating system, none have been well documented nor can be considered the basis for a standard.
.\"
.\"
.SH CONFORMANCE
.PP
This Corrigendum conforms where possible to the
.I Network Provider Interface Revision 2.0.0
.[
NPI Revision 2.0.0
.]
but its application to the Internet Protocol is implementation specific and not subject to
standardization.
.\"
.\"
.[
$LIST$
.]
.T2
