#!/usr/bin/make -f
# =============================================================================
# 
# @(#) $RCSfile: rules.in,v $ $Name:  $($Revision: 0.9.2.3 $) $Date: 2005/03/17 14:32:08 $
#
# -----------------------------------------------------------------------------
#
# Copyright (c) 2001-2005  OpenSS7 Corporation <http://www.openss7.com>
# Copyright (c) 1997-2000  Brian F. G. Bidulock <bidulock@openss7.org>
#
# All Rights Reserved.
#
# This program is free software; you can redistribute it and/or modify it under
# the terms of the GNU General Public License as published by the Free Software
# Foundation; either version 2 of the License, or (at your option) any later
# version.
#
# This program is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
# FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
# details.
#
# You should have received a copy of the GNU General Public License along with
# this program; if not, write to the Free Software Foundation, Inc., 675 Mass
# Ave, Cambridge, MA 02139, USA.
#
# -----------------------------------------------------------------------------
#
# U.S. GOVERNMENT RESTRICTED RIGHTS.  If you are licensing this Software on
# behalf of the U.S. Government ("Government"), the following provisions apply
# to you.  If the Software is supplied by the Department of Defense ("DoD"), it
# is classified as "Commercial Computer Software" under paragraph 252.227-7014
# of the DoD Supplement to the Federal Acquisition Regulations ("DFARS") (or any
# successor regulations) and the Government is acquiring only the license rights
# granted herein (the license rights customarily provided to non-Government
# users).  If the Software is supplied to any unit or agency of the Government
# other than DoD, it is classified as "Restricted Computer Software" and the
# Government's rights in the Software are defined in paragraph 52.227-19 of the
# Federal Acquisition Regulations ("FAR") (or any successor regulations) or, in
# the cases of NASA, in paragraph 18.52.227-86 of the NASA Supplement to the FAR
# (or any successor regulations).
#
# -----------------------------------------------------------------------------
#
# Commercial licensing and support of this software is available from OpenSS7
# Corporation at a fee.  See http://www.openss7.com/
#
# -----------------------------------------------------------------------------
#
# Last Modified $Date: 2005/03/17 14:32:08 $ by $Author: brian $
#
# =============================================================================

PACKAGE = @PACKAGE@
PACKAGE_LCNAME = @PACKAGE_LCNAME@
VERSION = @VERSION@
PACKAGE_DEBOPTIONS = @PACKAGE_DEBOPTIONS@
mytmpdir = /var/tmp/$(PACKAGE)-$(VERSION)

prefix = @prefix@
exec_prefix = @exec_prefix@
rootdir = @rootdir@
kversion = @kversion@

bindir = @bindir@
configdir = @configdir@
datadir = @datadir@
includedir = @includedir@
infodir = @infodir@
initrddir = @initrddir@
libdir = @libdir@
libexecdir = @libexecdir@
localstatedir = @localstatedir@
mandir = @mandir@
oldincludedir = @oldincludedir@
sbindir = @sbindir@
sharedstatedir = @sharedstatedir@
sysconfdir = @sysconfdir@
kmoduledir = @kmoduledir@

pkgdatadir = $(datadir)/$(PACKAGE)
pkglibdir = $(libdir)/$(PACKAGE)
pkgincludedir = $(includedir)/$(PACKAGE)

export DH_VERBOSE = 1
export DH_OPTIONS =

pkg_control_files =

pkg_control_files += debian/$(PACKAGE_LCNAME)-core-$(kversion)-$(VERSION).install

debian/$(PACKAGE_LCNAME)-core-$(kversion)-$(VERSION).install:
	( echo '$(mytmpdir)$(kmoduledir)/*' ) \
	| sed -r -e 's|^($(mytmpdir)/(.*))$$|\1 \2|;s|/[^/]*$$|/|' > $@

@WITH_KO_MODULES_FALSE@pkg_control_files += debian/$(PACKAGE_LCNAME)-info-$(kversion)-$(VERSION).install
@WITH_KO_MODULES_FALSE@
@WITH_KO_MODULES_FALSE@debian/$(PACKAGE_LCNAME)-info-$(kversion)-$(VERSION).install:
@WITH_KO_MODULES_FALSE@	( echo '$(mytmpdir)$(pkgincludedir)/$(kversion)/*' ) \
@WITH_KO_MODULES_FALSE@	| sed -r -e 's|^($(mytmpdir)/(.*))$$|\1 \2|;s|/[^/]*$$|/|' > $@

pkg_control_files += debian/$(PACKAGE_LCNAME)-lib-$(VERSION).install

debian/$(PACKAGE_LCNAME)-lib-$(VERSION).install:
	( echo '$(mytmpdir)$(libdir)/*.so*' ; \
	  echo '$(mytmpdir)$(libdir)/*.la' ) \
	| sed -r -e 's|^($(mytmpdir)/(.*))$$|\1 \2|;s|/[^/]*$$|/|' > $@

pkg_control_files += debian/$(PACKAGE_LCNAME)-doc-$(VERSION).docs

debian/$(PACKAGE_LCNAME)-doc-$(VERSION).docs:
	( echo "AUTHORS" ; \
	  echo "ChangeLog" ; \
	  echo "COPYING" ; \
	  echo "INSTALL" ; \
	  echo "NEWS" ; \
	  echo "README" ; \
	  echo "THANKS" ; \
	  echo "doc/manual" ; \
	  echo "$(PACKAGE)-$(VERSION).lsm" ) > $@

pkg_control_files += debian/$(PACKAGE_LCNAME)-doc-$(VERSION).manpages

debian/$(PACKAGE_LCNAME)-doc-$(VERSION).manpages:
	( find $(mytmpdir)$(mandir) \( -type f -or -type l \) -name '*.[1-9]*' ) > $@

@COOKED_MANPAGES_FALSE@pkg_control_files += debian/$(PACKAGE_LCNAME)-doc-$(VERSION).install
@COOKED_MANPAGES_FALSE@
@COOKED_MANPAGES_FALSE@debian/$(PACKAGE_LCNAME)-doc-$(VERSION).install:
@COOKED_MANPAGES_FALSE@	( echo '$(mytmpdir)$(mandir)/*.refs' ; \
@COOKED_MANPAGES_FALSE@	  echo '$(mytmpdir)$(mandir)/*.macros' ) \
@COOKED_MANPAGES_FALSE@	| sed -r -e 's|^($(mytmpdir)/(.*))$$|\1 \2|;s|/[^/]*$$|/|' > $@

pkg_control_files += debian/$(PACKAGE_LCNAME)-doc-$(VERSION).info

debian/$(PACKAGE_LCNAME)-doc-$(VERSION).info:
	( find $(mytmpdir)$(infodir) -type f -name '*.info*' ) > $@

pkg_control_files += debian/$(PACKAGE_LCNAME)-devel-$(VERSION).install

debian/$(PACKAGE_LCNAME)-devel-$(VERSION).install:
	( echo '$(mytmpdir)$(pkgincludedir)/*.h' ; \
	  echo '$(mytmpdir)$(pkgincludedir)/sys/*' ) \
	| sed -r -e 's|^($(mytmpdir)/(.*))$$|\1 \2|;s|/[^/]*$$|/|' > $@

#pkg_control_files += debian/$(PACKAGE_LCNAME)-source-$(VERSION).install

#debian/$(PACKAGE_LCNAME)-source-$(VERSION).install:
#	( echo '$(mytmpdir)/usr/src/*' ) \
#	| sed -r -e 's|^($(mytmpdir)/(.*))$$|\1 \2|;s|/[^/]*$$|/|' > $@

pkg_control_files += debian/$(PACKAGE_LCNAME)-util-$(VERSION).install

debian/$(PACKAGE_LCNAME)-util-$(VERSION).install:
	( echo '$(mytmpdir)$(bindir)/*' ; \
	  echo '$(mytmpdir)$(sbindir)/*' ; \
	  echo '$(mytmpdir)$(libexecdir)/*' ) \
	| sed -r -e 's|^($(mytmpdir)/(.*))$$|\1 \2|;s|/[^/]*$$|/|' > $@
@INSTALL_INITSCRIPTS_TRUE@	( echo '$(mytmpdir)$(sysconfdir)/*' ) \
@INSTALL_INITSCRIPTS_TRUE@	| sed -r -e 's|^($(mytmpdir)/(.*))$$|\1 \2|;s|/[^/]*$$|/|' >> $@

build: build-stamp
build-stamp:
	dh_testdir
	./configure $(PACKAGE_DEBOPTIONS) --disable-initscripts
	chmod +x debian/rules
	$(MAKE) -f Makefile
	chmod +x debian/rules
	touch build-stamp

clean:
	dh_testdir -v
	dh_testroot -v
	rm -f build-stamp
	[ ! -f Makefile ] || $(MAKE) -f Makefile clean
	[ ! -f Makefile ] || $(MAKE) -f Makefile distclean
	rm -fr $(mytmpdir)
	rm -f $(pkg_control_files)
	dh_clean -v

install: DH_OPTIONS =
install: build
	dh_testdir -v
	dh_testroot -v
	dh_clean -v -k
	dh_installdirs -v
	$(MAKE) -f Makefile DESTDIR=$(mytmpdir) install
	$(MAKE) -f debian/rules $(pkg_control_files)
	dh_install -v

binary-common:
	dh_testdir -v
	dh_testroot -v
	dh_installchangelogs -v
	dh_installdocs -v
	dh_installdebconf -v
	dh_installinit -v
	dh_installinfo -v
	dh_installman -v
	dh_strip -v
	dh_link -v
	dh_compress -v
	dh_fixperms -v
	dh_makeshlibs -v
	dh_installdeb -v
	dh_shlibdeps -v
	dh_gencontrol -v
	dh_md5sums -v
	dh_builddeb -v

# Build architecture-independent files here.
binary-indep: build install
	$(MAKE) -f debian/rules DH_OPTIONS=-i binary-common

# Build architecture-dependent files here.
binary-arch: build install
	$(MAKE) -f debian/rules DH_OPTIONS=-a binary-common

binary: binary-indep binary-arch

binary-%: build install
	$(MAKE) -f debian/rules DH_OPTIONS=-p$* binary-common

get-orig-source:
	wget http://www.openss7.org/$(PACKAGE)-$(VERSION).tar.bz

.PHONY: build clean binary-indep binary-arch binary install

