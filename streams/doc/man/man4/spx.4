'\" rtp
.\" -*- nroff -*- vim: ft=nroff
.\"
.\" @(#) $Id: spx.4,v 0.9.2.1 2004/02/29 19:06:54 brian Exp $
.\"
.\" =========================================================================
.\"
.\" Copyright (C) 2001-2003  OpenSS7 Corporation <www.openss7.com>
.\"
.\" All Rights Reserved.
.\"
.\" Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\"
.\" Permission is granted to copy and distribute modified versions of this
.\" manual under the conditions for verbatim copying, provided that the
.\" entire resulting derived work is distributed under the terms of a
.\" permission notice identical to this one
.\" 
.\" Since the Linux kernel and libraries are constantly changing, this
.\" manual page may be incorrect or out-of-date.  The author(s) assume no
.\" responsibility for errors or omissions, or for damages resulting from
.\" the use of the information contained herein.  The author(s) may not
.\" have taken the same level of care in the production of this manual,
.\" which is licensed free of charge, as they might when working
.\" professionally.
.\" 
.\" Formatted or processed versions of this manual, if unaccompanied by
.\" the source, must acknowledge the copyright and authors of this work.
.\"
.\" -------------------------------------------------------------------------
.\"
.\" U.S. GOVERNMENT RESTRICTED RIGHTS.  If you are licensing this Software
.\" on behalf of the U.S. Government ("Government"), the following
.\" provisions apply to you.  If the Software is supplied by the Department
.\" of Defense ("DoD"), it is classified as "Commercial Computer Software"
.\" under paragraph 252.227-7014 of the DoD Supplement to the Federal
.\" Acquisition Regulations ("DFARS") (or any successor regulations) and the
.\" Government is acquiring only the license rights granted herein (the
.\" license rights customarily provided to non-Government users).  If the
.\" Software is supplied to any unit or agency of the Government other than
.\" DoD, it is classified as "Restricted Computer Software" and the
.\" Government's rights in the Software are defined in paragraph 52.227-19
.\" of the Federal Acquisition Regulations ("FAR") (or any success
.\" regulations) or, in the cases of NASA, in paragraph 18.52.227-86 of the
.\" NASA Supplement to the FAR (or any successor regulations).
.\"
.\" =========================================================================
.\" 
.\" Commercial licensing and support of this software is available from
.\" OpenSS7 Corporation at a fee.  See http://www.openss7.com/
.\" 
.\" =========================================================================
.\"
.\" Last Modified $Date: 2004/02/29 19:06:54 $ by $Author: brian $
.\"
.\" =========================================================================
.so openss7.macros
.R1
bracket-label "\fR[\fB" "\fR]" "\fR, \fB"
no-default-database
database openss7.refs
accumulate
move-punctuation
abbreviate A
join-authors ", " ", " " and "
et-al " et al" 2 3
abbreviate-label-ranges ".."
sort-adjacent-labels
.R2
.\"
.\"
.TH SPX 4 "$Date: 2004/02/29 19:06:54 $" "$Name:  $" "Linux Fast-STREAMS Devices"
.\"
.\"
.SH NAME
.B spx, pipe
\- \fISTREAMS\fR bi-directional pipe device
.\"
.\"
.SH DESCRIPTION
.PP
The software pipes obtained by the system call
.BR pipe (2)
are not necessarily bidirectional.
.[
xbd5
.]
.[
susv2
.]
.[
susv3
.]
The
.B spx
.I STREAMS
pseudo-device driver provide a mechanism for obtaining
.IR STREAMS -based
pipes that are bidirectional in nature.
.PP
The
.B spx
pseudo-device driver is a regular
.I STREAMS
device driver.
.PP
Because the
.BR open (2)
system call only returns one file descriptor, the following procedure is used
to create two file descriptors with a connected
.IR STREAMS -based
pipe between them:
.IP (1) \w'(000)'u
Open
.B /dev/spx
an obtain a first file descriptor.  At this point there is only half of the
pipe available.
This step obtains
.IR fd [0].
.IP (2)
Open
.B /dev/spx
again to obtain a second file descriptor.  At this point there are two
unconnected stream heads.
This step obtains
.IR fd [2].
.IP (2)
Call
.BR ioctl (2)
with the
.B I_FDINSERT
command (see
.BR streamio (7))
to associate
.IR fd [0]
with
.IR fd [1].
This can either be accomplished by performing an
.B I_FDINSERT
with
.IR fd [1]
on the stream returned as
.IR fd [0];
or, with
.IR fd [0]
on
.IR fd [1].
The data part of the
.B I_FDINSERT
command is ignored, and the control part of the
.B I_FDINSERT
command contains only the file descriptor translated to a queue pointer.
This step connects
.IR fd [0]
to
.IR fd [1]
for a fully connected,
.IR STREAMS -based,
bi-directional pipe.
.\"
.\"
.SH USAGE
.PP
The characteristics of bi-directional
.IR STREAMS -based
pipes
.RB ( spipes )
by comparison to
SVR 3
.[
svr3
.]
style pipes is as follows:
.IP \(bu 2
.B spipes
are bi-directional.  Both sides are opened for both read and write.  Data
written to one end of the pipe can be read by the other.  Both ends of the
pipe can have data written and read.
.IP \(bu 2
.B spipes
can have modules pushed and popped from either side of the pipe.  (See also
.BR pipemod (4).)
.IP \(bu 2
.B spipes
can have the
.BR connld (4)
module can be pushed onto one end of the pipe.
.IP \(bu 2
.B spipes
have controllable flow control and minimum and maximum packet size characteristics.
.IP \(bu 2
.B spipes
permit the use of the
.BR getmsg (2),
.BR getpmsg (2),
.BR putmsg (2)
and
.BR putpmsg (2)
system calls on the pipe ends.
.IP \(bu 2
.B spipes
permit the use of
.I STREAMS
IO controls on either pipe end.  See
.BR streamio (7).
.\"
.\"
.SH NOTICES
.PP
Although an
.BR stat (2)
on the
.B /dev/spx
device node will show the node as being a character special device with a
device number corresponding to the
.B spx
driver, an
.BR fstat (2)
on the file descriptor resulting from an
.BR open (2)
call on
.B /dev/spx
will indicate that the file is a fifo.  This is rather normal
.IR UNIX \(rg
behavior.
.PP
Depending on
.IR Linux \(rg
kernel configuration parameters, it might not be necessary to go to this
extent to create a STREAMS-based bidirectional pipe.  When kernel confiration
parameter
.B CONFIG_STREAMS_PIPES_REPLACE
is set, then the SVR 3
.[
svr3
.]
pipe approach used by
.IR Linux \(rg
will be replaced with a bi-directional STREAMS-based pipe.  Then, a simple
call to
.BR pipe (2)
will return a bidirectional pipe and it is not necessary to open the
.B spx
driver to obtain one.
.\"
.\"
.SH DEVICES
.PP
.B /dev/spx
.\"
.\"
.SH "SEE ALSO"
.PP
.BR pipe (2),
.BR open (2),
.BR ioctl (2),
.BR streamio (7),
.BR pipemod (4),
.BR connld (4),
.BR getmsg (2),
.BR getpmsg (2),
.BR putmsg (2),
.BR putpmsg (2),
.BR stat (2),
.BR fstat (2).
.\"
.\"
.SH BUGS
.PP
.B spx
has no known bugs.
.\"
.\"
.SH COMPATIBILITY
.PP
.I Linux Fast-STREAMS
provides the
.B spx
device for compatibility with
.IR UnixWare \(rg
7.
.IR Solaris \(rg
and
.I LiS
.[
LiS
.]
do not provide an
.B spx
driver.
.\"
.\"
.SH CONFORMANCE
.PP
.IR UnixWare \(rg
7.1.1 documentation.
.\"
.\"
.SH HISTORY
.PP
.B spx
appears in
.IR UnixWare \(rg
7.1.1.
.\"
.\"
.[
$LIST$
.]
.TI

